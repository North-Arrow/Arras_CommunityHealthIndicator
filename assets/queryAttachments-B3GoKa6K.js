import{B as I,_ as i,z as s,dT as m,A as b,H as f,fm as j,fn as g}from"./MapPage-Dnc0zaB7.js";import{t as x}from"./query-C8joOCoU.js";import"./index-BR6_3zI-.js";import"./themeLevelStore-PUX48y2-.js";import"./normalizeUtils-CqXX84og.js";import"./Cyclical-BWcE0i9B.js";import"./normalizeUtilsCommon-Vv0Mh751.js";import"./pbfQueryUtils-naYkYHJ5.js";import"./pbf-D-YKaLiu.js";import"./memoryEstimations-Dschzk4d.js";import"./OptimizedFeature-excUmB3r.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-uIjWVy7g.js";import"./projectionUtils-v0NSj9sO.js";function v(e){const{exifInfo:t,exifName:o,tagName:a}=e;if(!t||!o||!a)return null;const r=t.find(l=>l.name===o);return r?O({tagName:a,tags:r.tags}):null}function O(e){const{tagName:t,tags:o}=e;return!o||!t?null:o.find(r=>r.name===t)?.value||null}var c;const $={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let n=c=class extends I{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=v({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return $[t]||null}clone(){return new c({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};i([s({type:String})],n.prototype,"contentType",void 0),i([s()],n.prototype,"exifInfo",void 0),i([s({readOnly:!0})],n.prototype,"orientationInfo",null),i([s({type:m})],n.prototype,"id",void 0),i([s({type:String})],n.prototype,"globalId",void 0),i([s({type:String})],n.prototype,"keywords",void 0),i([s({type:String})],n.prototype,"name",void 0),i([s({json:{read:!1}})],n.prototype,"parentGlobalId",void 0),i([s({json:{read:!1}})],n.prototype,"parentObjectId",void 0),i([s({type:m})],n.prototype,"size",void 0),i([s({json:{read:!1}})],n.prototype,"url",void 0),n=c=i([b("esri.rest.query.support.AttachmentInfo")],n);function w(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),t}function Q(e,t){const o={};for(const a of t){const{parentObjectId:r,parentGlobalId:l,attachmentInfos:p}=a;for(const d of p){const{id:y}=d,h=j(g(`${e.path}/${r}/attachments/${y}`)),u=n.fromJSON(d);u.set({url:h,parentObjectId:r,parentGlobalId:l}),o[r]?o[r].push(u):o[r]=[u]}}return o}function D(e,t,o){let a={query:x({...e.query,f:"json",...w(t)})};return o&&(a={...o,...a,query:{...o.query,...a.query}}),f(e.path+"/queryAttachments",a).then(r=>r.data.attachmentGroups)}async function E(e,t,o){const{objectIds:a}=t,r=[];for(const l of a)r.push(f(e.path+"/"+l+"/attachments",o));return Promise.all(r).then(l=>a.map((p,d)=>({parentObjectId:p,attachmentInfos:l[d].data.attachmentInfos})))}export{D as executeAttachmentQuery,E as fetchAttachments,Q as processAttachmentQueryResult};
