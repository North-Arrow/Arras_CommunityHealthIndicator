import{ac as We,aK as z,dD as ie,ce as b,bV as S,cf as p,cg as L,cF as X,c1 as fe,ch as F,l as Ie,gW as Xe,cd as Qe,b as et,cI as de,b9 as ye,cH as he,Z as tt,jE as nt,S as rt,i0 as st,B as pe,_ as N,z as v,A as me,jF as it,dp as at,dq as ot,H as lt,iE as ut,s as ct,U as ft,M as dt,e as yt}from"./MapPage-DGdIpuMu.js";import"./UnknownTimeZone-CYtVjdME.js";import{r as Me,m as j,i as Le,h as ht}from"./TimeOnly-rzRiVFnG.js";import{n as w}from"./enum-CBdIt2ZP.js";import{m as pt}from"./Field-BTSnUQ11.js";import{l as mt,p as gt}from"./number-M2PHGUNh.js";function bt(e){if(typeof e=="string")return e.toLowerCase();if("name"in e)return e.name.toLowerCase();if(typeof e.value!="string")throw new w(null,"InvalidIdentifier",null);return e.value.toLowerCase()}const ln=Object.freeze({aborted:!1});let ge=class{};class E{constructor(){}}function De(e,t,n){if(e instanceof E&&!(e instanceof ae)){const s=new ae;return s.fn=e,s.parameterEvaluator=n,s.context=t,s}return e}class cn extends E{constructor(t){super(),this.fn=t}createFunction(t){return(...n)=>this.fn(t,{preparsed:!0,arguments:n})}call(t,n){return this.fn(t,n)}marshalledCall(t,n,s,r){return r(t,n,(i,o,a)=>{a=a.map(c=>c instanceof E&&!(c instanceof ae)?De(c,t,r):c);const u=this.call(s,{args:a});return We(u)?u.then(c=>De(c,s,r)):u})}}let ae=class extends E{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(t){return this.fn.createFunction(this.context)}call(t,n){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}marshalledCall(t,n,s){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}};class J{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){return this.slice()}slice(t=0,n=this.length()){const s=[];for(let r=t;r<n;r++)s.push(this.get(r));return s}}let H=class je extends J{constructor(t,n,s,r,i,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=s,this._hasM=r,this._cacheId=i,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const n=this._elements[t];if(n===void 0)return;const s=new z(n[0],n[1],this._spRef);this._hasZ&&(s.z=n[2]),this._hasM&&(s.m=this._hasZ?n[3]:n[2]),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=s}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof je&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class be extends J{constructor(t,n,s,r,i){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=s,this._hasM=r,this._spRef=n,this._cacheId=i}get(t){if(this._lazyPath[t]===void 0){const n=this._elements[t];if(n===void 0)return;this._lazyPath[t]=new H(n,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof be&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}function dn(e){return pt.fromJSON(e.toJSON())}function St(e){return e.toJSON?e.toJSON():e}function yn(e){return e instanceof Date}function hn(e){return e instanceof ie}function pn(e){return e instanceof j}function mn(e){return e instanceof Le}function gn(e){return e instanceof Me}const bn=1e3,Sn={point:"point"},Ze={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},Tn={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function wn(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function _n(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,s=t.cmp&&(r=t.cmp,function(o){return function(a,u){const c={key:a,value:o[a]},d={key:u,value:o[u]};return r(c,d)}});var r;const i=[];return(function o(a){if(a?.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let u,c;if(Array.isArray(a)){for(c="[",u=0;u<a.length;u++)u&&(c+=","),c+=o(a[u])||"null";return c+"]"}if(a===null)return"null";if(i.includes(a)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=i.push(a)-1,h=Object.keys(a).sort(s?.(a));for(c="",u=0;u<h.length;u++){const C=h[u],_=o(a[C]);_&&(c&&(c+=","),c+=JSON.stringify(C)+":"+_)}return i.splice(d,1),"{"+c+"}"})(e)}function Tt(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function Nn(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return Tt(e)}}class wt{constructor(t){this.value=t}}class _t{constructor(t){this.value=t}}const T={type:"VOID"},Nt=Symbol("BREAK"),Ft=Symbol("CONTINUE");function B(e,t,n){return t===""||t==null||t===n||t===n?e:e=e.split(t).join(n)}function Y(e){return e instanceof E}function Se(e){return e instanceof ge}function q(e){return!!p(e)||!!S(e)||!!y(e)||!!m(e)||!!g(e)||!!b(e)||e===null||e===T}function vt(e,t){return e===void 0?t:e}function xt(e){return e==null?"":F(e)||O(e)?"Array":y(e)?"Date":g(e)?"Time":m(e)?"DateOnly":p(e)?"String":b(e)?"Boolean":S(e)?"Number":e?.declaredClass==="esri.arcade.Attachment"?"Attachment":e?.declaredClass==="esri.arcade.Portal"?"Portal":e?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":ve(e)?"KnowledgeGraph":e instanceof ge?"Module":K(e)?"Feature":e instanceof z?"Point":e instanceof de?"Polygon":e instanceof ye?"Polyline":e instanceof he?"Multipoint":e instanceof fe?"Extent":Y(e)?"Function":_e(e)?"FeatureSet":Fe(e)?"FeatureSetCollection":Te(e)?"Voxel":we(e)?"Pixel":e===T?"":typeof e=="number"&&isNaN(e)?"Number":"Unrecognized Type"}function Pe(e){return e===T}function te(e){return e instanceof L}function K(e){return e?.arcadeDeclaredClass==="esri.arcade.Feature"}function Te(e){return e?.arcadeDeclaredClass==="esri.arcade.Voxel"}function we(e){return e?.arcadeDeclaredClass==="esri.arcade.Pixel"}function _e(e){return e?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function Ne(e){return e?.declaredClass==="esri.arcade.Dictionary"}function Ot(e){return Ne(e)||K(e)||Te(e)||we(e)}function Fe(e){return e?.declaredRootClass==="esri.arcade.featureSetCollection"}function ve(e){return e?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function O(e){return e instanceof J}function y(e){return e instanceof j}function m(e){return e instanceof Le}function g(e){return e instanceof Me}function oe(e){return e!=null&&typeof e=="object"}function Ge(e,t,n,s,r){if(e.length<t||e.length>n)throw new w(s,"WrongNumberOfParameters",r)}function Ct(e){return e==null||Pe(e)||e===""}function kt(e){return e<0?-Math.round(-e):Math.round(e)}function xe(e,t){return isNaN(e)||t==null||t===""?e.toString():(t=B(t,"‰",""),t=B(t,"¤",""),mt(e,{pattern:t}))}function ne(e,t){return t==null||t===""?e.toISOString(!0):e.toFormat(Re(t),{locale:Ie(),numberingSystem:"latn"})}function Re(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const s=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const r of e.match(s)||[])switch(r){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=r;break;default:r.length>=2&&r.startsWith("[")&&r.endsWith("]")?n+=`'${r.slice(1,-1)}'`:n+=`'${r}'`}return n}function l(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function Dt(e,t,n){if(e===null){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(p(t)||b(t))return l(0,f(t),n);if(y(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}if(e===T){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(p(t)||b(t))return l(0,f(t),n);if(y(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}else if(S(e)){if(S(t))return l(e,t,n);if(b(t))return l(e,f(t),n);if(t===null||t===T)return l(e,0,n);if(p(t))return l(e,f(t),n);if(y(t)||g(t)||m(t))return l(e,t.toNumber(),n)}else if(p(e)){if(p(t))return l(A(e),A(t),n);if(y(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(S(t))return l(f(e),t,n);if(t===null||t===T)return l(f(e),0,n);if(b(t))return l(f(e),f(t),n)}else if(y(e)){if(y(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=j.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=j.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))throw new w(null,"CannotCompareDateAndTime",null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(b(e)){if(b(t))return l(e,t,n);if(S(t))return l(f(e),f(t),n);if(y(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(t===null||t===T)return l(f(e),0,n);if(p(t))return l(f(e),f(t),n)}else if(m(e)){if(y(t))return l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))throw new w(null,"CannotCompareDateAndTime",null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(g(e)){if(y(t))throw new w(null,"CannotCompareDateAndTime",null);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))return l(e.toNumber(),t.toNumber(),n);if(m(t))throw new w(null,"CannotCompareDateAndTime",null)}return!!$e(e,t)&&(n==="<="||n===">=")}function $e(e,t){if(e===t||e===null&&t===T||t===null&&e===T)return!0;if(y(e)&&y(t)||g(e)&&g(t)||m(e)&&m(t))return e.equals(t);if(e instanceof be||e instanceof H)return e.equalityTest(t);if(e instanceof z&&t instanceof z){const n=e.cache._arcadeCacheId,s=t.cache._arcadeCacheId;if(n!=null)return n===s}return!!(oe(e)&&oe(t)&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null))}function ze(e,{useNumbersForDates:t}){let n="";for(const s in e){n!==""&&(n+=",");const r=e[s];r==null?n+=JSON.stringify(s)+":null":b(r)||S(r)||p(r)?n+=JSON.stringify(s)+":"+JSON.stringify(r):te(r)?n+=JSON.stringify(s)+":"+$(r):g(r)||m(r)?n+=`${JSON.stringify(s)}:${JSON.stringify(r.toString())}`:O(r)||Array.isArray(r)?n+=JSON.stringify(s)+":"+$(r,null,t):y(r)?n+=t?JSON.stringify(s)+":"+JSON.stringify(r.getTime()):JSON.stringify(s)+":"+r.stringify():r!==null&&typeof r=="object"&&"castToText"in r&&(n+=JSON.stringify(s)+":"+r.castToText(t))}return"{"+n+"}"}function A(e,t){if(p(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(y(e))return ne(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof L)return JSON.stringify(e.toJSON());if(F(e)){const n=[];for(let s=0;s<e.length;s++)n[s]=Q(e[s]);return"["+n.join(",")+"]"}if(e instanceof J){const n=[];for(let s=0;s<e.length();s++)n[s]=Q(e.get(s));return"["+n.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText():Y(e)?"object, Function":e===T?"":Se(e)?"object, Module":""}function Zt(e){const t=[];if(e instanceof J){for(let n=0;n<e.length();n++)t[n]=f(e.get(n));return t}if(!F(e))return null;for(let n=0;n<e.length;n++)t[n]=f(e[n]);return t}function $(e,t,n=!1){if(p(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(y(e))return ne(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof L)return e instanceof fe?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+le(e.spatialReference)+"}":le(e.toJSON(),(s,r)=>s.key===r.key?0:s.key==="spatialReference"?1:r.key==="spatialReference"||s.key<r.key?-1:s.key>r.key?1:0);if(F(e)){const s=[];for(let r=0;r<e.length;r++)s[r]=Q(e[r],n);return"["+s.join(",")+"]"}if(e instanceof J){const s=[];for(let r=0;r<e.length();r++)s[r]=Q(e.get(r),n);return"["+s.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText(n):Y(e)?"object, Function":e===T?"":Se(e)?"object, Module":""}function Q(e,t=!1){if(e===null)return"null";if(b(e)||p(e))return JSON.stringify(e);if(S(e))return e.toString();if(e instanceof L||e instanceof J||Array.isArray(e))return $(e,null,t);if(y(e))return JSON.stringify(t?e.getTime():ne(e,""));if(g(e)||m(e))return JSON.stringify(e.toString());if(e!==null&&typeof e=="object"){if("castToText"in e)return e.castToText(t)}else if(e===T)return"null";return"null"}function f(e,t){return S(e)?e:e===null||e===""?0:y(e)||m(e)||g(e)?NaN:b(e)?e?1:0:F(e)||e===""||e===void 0?NaN:t!==void 0&&p(e)?(t=B(t,"‰",""),t=B(t,"¤",""),gt(e,{pattern:t})):e===T?0:Number(e)}function At(e,t){if(y(e))return e;if(p(e)){const n=Jt(e,t);if(n)return j.dateTimeToArcadeDate(n)}return null}function Jt(e,t){const n=/ (\d\d)/,s=ht(t);let r=ie.fromISO(e,{zone:s});return r.isValid||n.test(e)&&(e=e.replace(n,"T$1"),r=ie.fromISO(e,{zone:t}),r.isValid)?r:null}function It(e){return b(e)?e:p(e)?(e=e.toLowerCase())==="true":!!S(e)&&e!==0&&!isNaN(e)}function Mt(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),et(n)}function Lt(e,t){return e==null?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function jt(e){if(e===null)return null;if(e instanceof z)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof de){if((e.curveRings??e.rings).length===0)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof ye){if((e.curvePaths??e.paths).length===0)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof he?e.points.length===0?null:e:e instanceof fe?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function qe(e,t){if(!e||!e.domain)return t;let n=null,s=null;if(y(t))n=t.toNumber();else if(m(t))n=t.toString();else if(g(t))n=t.toStorageString();else if(e.field.type==="string"||e.field.type==="esriFieldTypeString")n=A(t);else{if(t==null)return null;if(t==="")return t;n=f(t)}for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.code===n&&(s=i)}return s===null?A(t):s.name}function Ue(e,t){if(!e||!e.domain)return t;let n=null;const s=A(t);for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.name===s&&(n=i)}return n===null?t:n.code}function re(e,t,n=null,s=null){if(!t||!t.fields)return null;let r,i,o=null;for(let d=0;d<t.fields.length;d++){const h=t.fields[d];h.name.toLowerCase()===e.toString().toLowerCase()&&(o=h)}if(o===null)throw new w(null,"FieldNotFound",null,{key:e});let a=t.typeIdField,u="id",c=t.types;if(t.subtypeField&&(a=t.subtypeField,u="code",c=t.subtypes??[]),s===null&&n&&a)s=n.hasField(a)?n.field(a):null;else if(a&&s!==null){let d=!1;for(const h of c||[])if(s===h[u]){d=!0;break}if(!d){for(const h of c||[])if(s===h.name){s=h[u],d=!0;break}}d||(s=null,n&&a&&(s=n.hasField(a)?n.field(a):null))}return s!=null&&c.some(d=>d[u]===s&&(r=d.domains?.[o.name],r&&r.type==="inherited"&&(r=Ae(o.name,t),i=!0),!0)),i||r||(r=Ae(e,t)),{field:o,domain:r}}function Ae(e,t){let n;return t.fields.some(s=>(s.name.toLowerCase()===e.toLowerCase()&&(n=s.domain),!!n)),n}function le(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,s=t.cmp&&(r=t.cmp,function(o){return function(a,u){const c={key:a,value:o[a]},d={key:u,value:o[u]};return r(c,d)}});var r;const i=[];return(function o(a){if(a?.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let u,c;if(Array.isArray(a)){for(c="[",u=0;u<a.length;u++)u&&(c+=","),c+=o(a[u])||"null";return c+"]"}if(a===null)return"null";if(i.includes(a)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=i.push(a)-1,h=Object.keys(a).sort(s?.(a));for(c="",u=0;u<h.length;u++){const C=h[u],_=o(a[C]);_&&(c&&(c+=","),c+=JSON.stringify(C)+":"+_)}return i.splice(d,1),"{"+c+"}"})(e)}function Pt(e){if(e===null)return null;const t=[];for(const n of e)K(n)?t.push(n.geometry()):t.push(n);return t}function U(e,t){if(!(t instanceof z))throw new w(null,"InvalidParameter",null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Gt(e,t){if(F(e)||O(e)){let n=!1,s=!1,r=[],i=t;if(F(e)){for(const o of e)U(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ,s=e[0].hasM)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else{if(!O(e))throw new w(null,"InvalidParameter",null);for(const o of e.toArray())U(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:(st(r)||(r=r.slice().reverse()),new de({rings:[r],spatialReference:i,hasZ:n,hasM:s}))}return e}function Rt(e,t){if(F(e)||O(e)){let n=!1,s=!1,r=[],i=t;if(F(e)){for(const o of e)U(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ===!0,s=e[0].hasM===!0)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else if(O(e)){for(const o of e.toArray())U(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:new ye({paths:[r],spatialReference:i,hasZ:n,hasM:s})}return e}function $t(e,t){if(F(e)||O(e)){let n=!1,s=!1,r=[],i=t;if(F(e)){for(const o of e)U(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ===!0,s=e[0].hasM===!0)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else if(O(e)){for(const o of e.toArray())U(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:new he({points:r,spatialReference:i,hasZ:n,hasM:s})}return e}function ue(e,t=!0){if(e==null)return[];if(F(e)){const n=[];for(const s of e){const r=A(s);(t||r!=="")&&n.push(r)}return n}if(O(e)){const n=[];for(let s=0;s<e.length();s++){const r=A(e.get(s));(t||r!=="")&&n.push(r)}return n}if(q(e)){const n=A(e);if(t||n!=="")return[n]}return[]}let se=0;function zt(e){return se++,se%100==0?(se=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function qt(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function R(e,t=null){return e==null?null:b(e)||S(e)||p(e)?e:e instanceof L?t?.keepGeometryType===!0?e:e.toJSON():e instanceof J?e.toArray().map(n=>R(n,t)):Array.isArray(e)?e.map(n=>R(n,t)):X(e)?e:y(e)?e.toJSDate():g(e)?e.toString():m(e)?e.toJSDate():e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function Ut(e,t,n,s,r){const i=await Oe(e,t,n);r[s]=i}async function Oe(e,t=null,n=null){if(e instanceof J&&(e=e.toArray()),e==null)return null;if(q(e)||e instanceof L||X(e)||y(e))return R(e,n);if(Array.isArray(e)){const s=[],r=[];for(const i of e)i===null||q(i)||i instanceof L||X(i)||y(i)?r.push(R(i,n)):(r.push(null),s.push(Ut(i,t,n,r.length-1,r)));return s.length>0&&await Promise.all(s),r}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,n):null}function W(e){return Ye(e)?e.parent:e}function Ye(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.support.SubtypeSublayer"}function Yt(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Et(e,t,n){const s=W(e.fullSchema());return s===null||!s.fields?null:re(t,s,e,n)}function Bt(e){const t=W(e.fullSchema());return t===null?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map(n=>({name:n.name,code:n.code})):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function Vt(e,t,n,s){const r=W(e.fullSchema());if(r===null||!r.fields)return null;const i=re(t,r,e,s);if(n===void 0)try{n=e.field(t)}catch{return null}return qe(i,n)}function Ht(e,t,n,s){const r=W(e.fullSchema());if(r===null||!r.fields)return null;if(n===void 0){try{n=e.field(t)}catch{return null}return n}return Ue(re(t,r,e,s),n)}function Kt(e){return e?.timeZone??"system"}function Wt(e){const t=W(e.fullSchema());if(t===null||!t.fields)return null;const n=[];for(const s of t.fields)n.push(St(s));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:Ze[t.geometryType]===void 0?"":Ze[t.geometryType],fields:n}}function Xt(e,t){const n=j.systemTimeZoneCanonicalName;return e==="system"&&(e=n),{version:Ee,engineVersion:nt,timeZone:e,userTimeZone:n,spatialReference:t instanceof rt?t.toJSON():t,application:tt.applicationName??"",engine:"web",locale:Ie()}}const Ee="1.34",Fn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:_t,ReturnResult:wt,absRound:kt,arcadeVersion:Ee,autoCastArrayOfPointsToMultiPoint:$t,autoCastArrayOfPointsToPolygon:Gt,autoCastArrayOfPointsToPolyline:Rt,autoCastFeatureToGeometry:Pt,binaryOperator:qt,breakResult:Nt,castAsJson:R,castAsJsonAsync:Oe,castRecordToText:ze,continueResult:Ft,defaultExecutingContext:Xt,defaultTimeZone:Kt,defaultUndefined:vt,equalityTest:$e,featureDomainCodeLookup:Ht,featureDomainValueLookup:Vt,featureFullDomain:Et,featureSchema:Wt,featureSubtypes:Bt,fixNullGeometry:jt,fixSpatialReference:Lt,formatDate:ne,formatNumber:xe,getDomain:re,getDomainCode:Ue,getDomainValue:qe,getType:xt,greaterThanLessThan:Dt,isArray:F,isBoolean:b,isDate:y,isDateOnly:m,isDictionary:Ne,isDictionaryLike:Ot,isEmpty:Ct,isFeature:K,isFeatureSet:_e,isFeatureSetCollection:Fe,isFunctionParameter:Y,isGeometry:te,isGraphic:Qe,isImmutableArray:O,isInteger:Xe,isJsDate:X,isKnowledgeGraph:ve,isModule:Se,isNumber:S,isObject:oe,isPixel:we,isSimpleType:q,isString:p,isSubtypeGrouplayer:Yt,isSubtypeSublayer:Ye,isTime:g,isVoid:Pe,isVoxel:Te,multiReplace:B,parseGeometryFromJson:Mt,pcCheck:Ge,stableStringify:le,standardiseDateFormat:Re,tick:zt,toBoolean:It,toDate:At,toNumber:f,toNumberArray:Zt,toString:A,toStringArray:ue,toStringExplicit:$,voidOperation:T},Symbol.toStringTag,{value:"Module"}));function vn(e){Be=e}let Be;function ce(e){return e===null?null:y(e)?e.clone():q(e)?e:te(e)?e.clone():O(e)?e.toArray().map(t=>ce(t)):F(e)?e.map(t=>ce(t)):K(e)?Be.createFromArcadeFeature(e):Fe(e)||_e(e)?e:Ne(e)||e?.declaredClass==="esri.arcade.Attachment"?e.deepClone():(e?.declaredClass==="esri.arcade.Portal"||ve(e)||e instanceof ge||Y(e),e)}function ee(e,t,n=!1,s=!1){if(e==null)return null;if(S(e)||b(e)||p(e)||y(e)||m(e)||g(e))return e;if(F(e)){const i=[];for(const o of e)i.push(ee(o,t,n,s));return i}if(s&&te(e))return e;const r=new D;r.immutable=!1;for(const[i,o]of Object.entries(e))o!==void 0&&r.setField(i,ee(o,t,n,s));return r.immutable=n,r}class D{constructor(t){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,t instanceof D?this.attributes=t.attributes:t==null?this.attributes=Object.create(null):Object.getPrototypeOf(t)!=null?this.attributes={__proto__:null,...t}:this.attributes=t}static containerEntry(t,n){return new D({__proto__:null,key:t,value:n})}static textFormatting(){const t=new D({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return t.immutable=!1,t}field(t){const n=t.toLowerCase(),s=this.attributes[t];if(s!==void 0)return s;for(const r in this.attributes)if(r.toLowerCase()===n)return this.attributes[r];throw new w(null,"FieldNotFound",null,{key:t})}setField(t,n){if(this.immutable)throw new w(null,"Immutable",null);if(Y(n))throw new w(null,"NoFunctionInDictionary",null);const s=t.toLowerCase();if(n instanceof Date&&(n=j.dateJSToArcadeDate(n)),this.attributes[t]===void 0){for(const r in this.attributes)if(r.toLowerCase()===s)return void(this.attributes[r]=n);this.attributes[t]=n}else this.attributes[t]=n}eraseField(t){if(this.immutable)throw new w(null,"Immutable",null);if(t in this.attributes)return void delete this.attributes[t];const n=t.toLowerCase();for(const s in this.attributes)if(s.toLowerCase()===n)return void delete this.attributes[s]}hasField(t){const n=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(const s in this.attributes)if(s.toLowerCase()===n)return!0;return!1}keys(){let t=[];for(const n in this.attributes)t.push(n);return t=t.sort(),t}values(){return this.keys().map(t=>this.attributes[t])}entryCount(){return Object.keys(this.attributes).length}isEmpty(){return this.entryCount()<=0}castToText(t=!1){return ze(this.attributes,{useNumbersForDates:t})}static convertObjectToArcadeDictionary(t,n,s=!0,r=!1){const i=new D;i.immutable=!1;for(const o in t){const a=t[o];a!==void 0&&i.setField(o.toString(),ee(a,n,s,r))}return i.immutable=s,i}static convertJsonToArcade(t,n,s=!1,r=!1){return ee(t,n,s,r)}castAsJson(t=null){const n=Object.create(null);for(let s in this.attributes){const r=this.attributes[s];r!==void 0&&(t?.keyTranslate&&(s=t.keyTranslate(s)),n[s]=R(r,t))}return n}async castDictionaryValueAsJsonAsync(t,n,s,r=null,i){const o=await Oe(s,r,i);return t[n]=o,o}async castAsJsonAsync(t=null,n=null){const s=Object.create(null),r=[];for(let i in this.attributes){const o=this.attributes[i];n?.keyTranslate&&(i=n.keyTranslate(i)),o!==void 0&&(q(o)||o instanceof L||o instanceof j?s[i]=R(o,n):r.push(this.castDictionaryValueAsJsonAsync(s,i,o,t,n)))}return r.length>0&&await Promise.all(r),s}deepClone(){const t=new D;t.immutable=!1;for(const n of this.keys())t.setField(n,ce(this.field(n)));return t}}let Z=class extends pe{constructor(t){super(t),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};N([v({type:String,json:{write:!0}})],Z.prototype,"key",void 0),N([v({type:String,json:{write:!0}})],Z.prototype,"text",void 0),N([v({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],Z.prototype,"detectedLanguage",void 0),N([v({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],Z.prototype,"detectedLanguageScore",void 0),N([v({type:Object,json:{write:!0}})],Z.prototype,"translation",void 0),Z=N([me("esri.rest.support.TranslateResult")],Z);async function Qt(e,t,n){const s=t.toJSON();s.contents=JSON.stringify(s.contents),s.token=await it(t.portalUrl,t.apiKey,{signal:n?.signal,prompt:n?.authMode!=="no-prompt"});const r=at(e),i=ot(r.query,{...n,query:s,method:"post",authMode:"anonymous"});return(await lt(r.path,i)).data.results.map(o=>Z.fromJSON(o))}let G=class extends pe{constructor(e){super(e)}};N([v({type:String,json:{write:!0}})],G.prototype,"key",void 0),N([v({type:String,json:{write:!0}})],G.prototype,"text",void 0),G=N([me("esri.rest.support.TranslateContent")],G);let k=class extends pe{constructor(e){super(e),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};N([v({type:[String],json:{write:!0}})],k.prototype,"to",void 0),N([v({type:[G],json:{write:!0}})],k.prototype,"contents",void 0),N([v({type:String,json:{write:!0}})],k.prototype,"portalUrl",void 0),N([v({type:String,json:{write:!0,default:"esri"}})],k.prototype,"translator",void 0),N([v({type:String,json:{write:!0}})],k.prototype,"from",void 0),N([v(ut)],k.prototype,"apiKey",void 0),N([v({type:String,json:{name:"x-esri-request-source"}})],k.prototype,"requestSource",void 0),k=N([me("esri.rest.support.TranslateParameters")],k);class Ce{constructor(t,n){this.portal=t,this._debugLog=n}async translate(t){this.portal.loaded||await this.portal.load();const n=this.portal.helperServices?.aiUtilityServices;if(n==null)return{success:!1};const s=n.url+n.translateUtility;try{return t.requestSource??="arcade",{success:!0,results:(await Qt(s,t,{authMode:"no-prompt"})).map(r=>r.toJSON())}}catch(r){return this._debugLog!=null&&(r instanceof Error||r instanceof ct)&&this._debugLog(`TranslateText error: ${r.message}`),ft.getLogger("esri.arcade.functions.aiServices").error(r),{success:!1}}}}class en{constructor(t,n,s){this._parameters=t,this._maxTotalContentSize=n,this._maxContentsLength=s,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(t){const n=new Set(t.filter(i=>!this._normalizedContents.has(i.text)).map(i=>i.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let s=0;for(const i of n)s+=i.length;if((s+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const r=this._requests.length;for(const{key:i,text:o}of t)yt(this._normalizedContents,o,()=>[]).push({batchIdx:r,key:i});return this._requests.push(t),this._contentsTotalSize+=s,r}async send(t){const n=[],s=[];let r=0;for(const[u,c]of this._normalizedContents)n.push(new G({key:String(r++),text:u})),s.push(c);const i=new k(this._parameters);i.contents=n;const o=await t.translate(i);if(!o.success)return Array.from(this._requests,()=>o);const a=Array.from(this._requests,()=>({success:!0,results:[]}));for(const u of o.results){const c=Number(u.key);for(const d of s[c])a[d.batchIdx].results.push({...u,key:d.key})}return a}}function V(e){const t=[...new Set(e.to)].sort(),n=e.from??null,s=e.portalUrl,r=e.translator,i=e.apiKey??null;return JSON.stringify([t,n,s,r,i])}async function Je(e,t,n){try{return(await e.yieldFor(n))[t]}catch{return{success:!1}}}class Ve{constructor(t,n,{maxTotalContentSize:s=5e4,maxContentsLength:r=1e3}={}){this._executor=t,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=s,this._maxContentsLength=r}create(t){return{translate:async n=>{const s=V(n),{contents:r,to:i,from:o,translator:a,portalUrl:u,apiKey:c}=n;if(i==null)return{success:!1};if(r==null||r.every(_=>_.text.length===0))return{success:!1};const d=this._openBatches.get(s);if(d!=null){const _=d.data.tryAdd(r);if(_!=null)return await Je(t,_,d);d.send()}const h=new en({to:i,from:o,translator:a,portalUrl:u,apiKey:c},this._maxTotalContentSize,this._maxContentsLength),C=h.tryAdd(r);if(C!=null){const _=this._executor.openBatch(h,{open:P=>{this._openBatches.set(s,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(s)===P&&this._openBatches.delete(s)}});return await Je(t,C,_)}return await this._service.translate(n)}}}}function He(e){e.mode==="async"&&(e.functions[bt("TranslateText")]=function(t,n){return e.standardFunctionAsync(t,n,async(s,r,i)=>{if(Ge(i,2,3,s,r),!p(i[0])&&!F(i[0])&&!O(i[0]))throw new w(s,"InvalidParameter",r);const o=ue(i[0]);if(!p(i[1])&&!F(i[1])&&!O(i[1]))throw new w(s,"InvalidParameter",r);const a=ue(i[1]);let u=null;if(i.length>=3){if(!p(i[2]))throw new w(s,"InvalidParameter",r);u=i[2]}const c=o.map((I,x)=>new G({key:String(x),text:I})),d=s.services?.portal??dt.getDefault(),h=new k({to:a,contents:c,from:u,portalUrl:d.restUrl.replace(/\/sharing\/rest$/,"")}),C=new Map;let _=null;if(s.lrucache!=null){const I=s.lrucache;_??=V(h),h.contents=h.contents?.filter(x=>{const M=I.getCachedTranslation(_,x.text);return M==null||(C.set(x.key,{...M,key:x.key,text:x.text}),!1)})}if(h.contents?.length){const I=s.services?.translation??new Ce(d,s.console),x=await I.translate(h);if(!x.success)return new D({__proto__:null,success:!1});for(const M of x.results){const ke=h.contents?.find(Ke=>Ke.key===M.key)?.text;if(ke==null)throw new w(null,"NeverReach",null);C.set(M.key,M),s.lrucache!=null&&(_??=V(h),s.lrucache.setCachedTranslation(_,ke,{detectedLanguage:M.detectedLanguage,translation:M.translation}))}}const P=Array.from(c,I=>{const x=Z.fromJSON(C.get(I.key));if(x==null)throw new w(null,"NeverReach",null);return x.text=I.text,D.convertJsonToArcade(x.toJSON(),s.timeZone??"system",!0)});return new D({__proto__:null,success:!0,results:P})})})}const On=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Ve,PortalTranslationService:Ce,getTranslateParametersKey:V,registerFunctions:He},Symbol.toStringTag,{value:"Module"})),Cn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Ve,PortalTranslationService:Ce,getTranslateParametersKey:V,registerFunctions:He},Symbol.toStringTag,{value:"Module"}));export{Vt as $,y as A,_e as B,re as C,m as D,g as E,Lt as F,Gt as G,K as H,Ft as I,Pt as J,Ne as K,Y as L,Rt as M,$t as N,Ue as O,T as P,Ot as Q,wt as R,f as S,On as T,te as U,It as V,Bt as W,Fe as X,J as Y,At as Z,Nt as _,qt as a,ue as a0,Nn as a1,B as a2,dn as a3,hn as a4,yn as a5,gn as a6,pn as a7,mn as a8,Sn as a9,St as aa,Ze as ab,zt as ac,bn as ad,_n as ae,wn as af,Tt as ag,Ye as ah,H as ai,be as aj,ze as ak,q as al,R as am,vn as an,ce as ao,xt as ap,Re as aq,kt as ar,jt as as,Te as at,we as au,Zt as av,Xt as aw,Fn as ax,Cn as ay,O as b,ae as c,Dt as d,cn as e,E as f,A as g,Kt as h,Et as i,Ht as j,$ as k,Wt as l,Tn as m,De as n,Ge as o,D as p,Pe as q,bt as r,ge as s,ln as t,Ct as u,_t as v,ve as w,qe as x,$e as y,vt as z};
