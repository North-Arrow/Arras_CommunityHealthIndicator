import{dE as B,bO as K,dF as W,dG as Z,aZ as V,dH as an,dI as ln,dJ as sn,dK as un,dL as R,dM as cn,U as fn,dN as z,dO as pn,df as mn,dP as gn}from"./MapPage-COzn-Qm3.js";import{h as b,B as yn,f as C,n as dn,c as U}from"./mat4-hUksrAJ2.js";import{N as q,A as An,y as Q,c as wn,E as hn}from"./vec32-BRGMkWll.js";import{c as xn,a as X}from"./spatialReferenceEllipsoidUtils-DG3i9-7V.js";import{f as T}from"./computeTranslationToOriginAndRotation-BF-URbKh.js";import{i as D}from"./projectPointToVector-CTO8u7H-.js";import{t as Tn,a as $n}from"./meshVertexSpaceUtils-BInjmMEF.js";import{n as j,d as nn,a as F,r as k}from"./vec3-C99QwtBb.js";import{o as rn}from"./projectionUtils-BZTDC0sZ.js";import{o as w,U as h}from"./BufferView-DRDRszCm.js";import{o as vn}from"./vec4-Iz1YWFcj.js";const nr="Projection may be possible after calling projection.load().";function A(n,r,t,e){n.error(`Failed to project from (wkid:${r.wkid}) to (wkid:${t.wkid}).${e?" ":""}${e}`)}function Fn(n,r,t,e,o,l){return N(0,w.fromTypedArray(n),0,h.fromTypedArray(r),t,h.fromTypedArray(e),o,w.fromTypedArray(l))?l:null}function En(n,r,t,e,o,l){return N(1,w.fromTypedArray(n),0,h.fromTypedArray(r),t,h.fromTypedArray(e),o,w.fromTypedArray(l))?l:null}function Sn(n,r,t,e){return rn(n,r,0,t,e,0)?t:null}function Mn(n,r,t,e){return rn(n,r,0,t,e,0)?t:null}function tn(n,r,t){return B(f,t),j(r,n,f),W(f)&&nn(r,r),r}function en(n,r,t){return Z(f,t),vn(r,n,f),W(f)&&nn(r,r,4),r}function Rn(n,r,t,e,o,l){if(!N(0,w.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),1,h.fromTypedArray(r),t,h.fromTypedArray(e),o,w.fromTypedArray(l,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let a=3;a<n.length;a+=4)l[a]=n[a];return l}function bn(n,r,t,e,o,l){if(!N(1,w.fromTypedArray(n,16),1,h.fromTypedArray(r),t,h.fromTypedArray(e),o,w.fromTypedArray(l,16)))return null;for(let a=3;a<n.length;a+=4)l[a]=n[a];return l}function H(n,r,t,e,o){switch(T(e,t,$,e),n===1&&b($,$),r){case 0:return B(o,$);case 1:return Z(o,$)}}function N(n,r,t,e,o,l,a,i){if(!r)return;const c=e.count;if(Nn(o))for(let s=0;s<c;s++)l.getVec(s,M),r.getVec(s,d),q(d,d,H(n,t,M,a,f)),i.setVec(s,d);else for(let s=0;s<c;s++){l.getVec(s,M),r.getVec(s,d);const p=an(e.get(s,1));let u=Math.cos(p);t===1!=(n===0)&&(u=1/u),H(n,t,M,a,f),n===0?(f[0]*=u,f[1]*=u,f[2]*=u,f[3]*=u,f[4]*=u,f[5]*=u):(f[0]*=u,f[3]*=u,f[6]*=u,f[1]*=u,f[4]*=u,f[7]*=u),q(d,d,f),An(d,d),i.setVec(s,d)}return i}function Nn(n){return n.isWGS84||ln(n)||sn(n)||un(n)}const M=V(),d=V(),$=R(),f=K(),g=()=>fn.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function rr(n,r,{vertexSpace:t,spatialReference:e}){if(t.type==="georeferenced"){const s=n;if(!D(r,s,e))return!1;const{origin:p}=t;return wn(n,s,p),!0}const o=X(e),l=n;if(!D(r,l,o))return!1;const{origin:a}=t,i=J;if(!T(e,a,i,o))return!1;const c=b(J,i);return c!=null&&(hn(n,l,c),!0)}function tr(n,r,t){const{vertexSpace:e,transform:o,vertexAttributes:l}=n,a=Tn(e)?o:null,i=P(n.spatialReference,t,3);if($n(e,r)&&(!a||yn(a.localMatrix,z))&&E(i)){const{position:c,normal:s,tangent:p}=l,u=t?.allowBufferReuse;return{position:u?c:c.slice(),normal:u?s:s?.slice(),tangent:u?p:p?.slice()}}switch(n.vertexSpace.type){case"local":return r.type==="local"?jn(n,n.vertexSpace,r.origin,t):Un(n,n.vertexSpace,r.origin,t);case"georeferenced":return r.type==="local"?Bn(n,n.vertexSpace,r.origin,t):Pn(n,n.vertexSpace,r.origin,t)}}function Pn({vertexAttributes:n,transform:r,spatialReference:t},{origin:e},o,l){const a=P(t,l,3),i=e||!E(a)?dn(m,r?.localMatrix??z):null;i&&G(i,t,l,3);const{position:c,normal:s,tangent:p}=i?_(n,i):n,u=l?.allowBufferReuse,x=u?c:new Float64Array(c.length);let y=c;if(e&&(y=F(x,y,e)),o){const S=Q(on,o);y=F(x,y,S)}return{position:y!==n.position||u?y:y.slice(),normal:s!==n.normal||u?s:s?.slice(),tangent:p!==n.tangent||u?p:p?.slice()}}function L(n,r){return r?.useEllipsoid&&gn(n)?xn:X(n)}function Un({spatialReference:n,vertexAttributes:r,transform:t},{origin:e},o,l){const a=L(n,l);if(!T(n,e,m,a))return A(g(),n,a),null;t&&U(m,m,t.localMatrix),G(m,n,l,1);const i=new Float64Array(r.position.length),c=kn(r.position,m,n,i,a);if(!c)return null;const s=Ln(c,n,i,a,r.normal,m);if(r.normal&&!s)return null;const p=_n(c,n,i,a,r.tangent,m);if(r.tangent&&!p)return null;if(o){const u=Q(on,o);F(c,c,u)}return{position:c,normal:s,tangent:p}}function Bn({vertexAttributes:n,spatialReference:r,transform:t},{origin:e},o,l){const a=L(r,l);if(!T(r,o,m,a))return A(g(),r,a),null;const i=1/P(r,l,2);C(m,m,[i,i,i]);const c=b(v,m),{position:s,normal:p,tangent:u}=Vn(n,e,t),x=new Float64Array(s.length),y=Gn(s,r,c,x,a);if(!y)return null;const S=B(qn,c),Y=Yn(p,s,r,x,a,S,p!==n.normal?p:void 0);if(!Y&&p)return null;const O=On(u,s,r,x,a,S,u!==n.tangent?u:void 0);return!O&&u?null:{position:y,normal:Y,tangent:O}}function Vn(n,r,t){if(!r)return n;if(!t){const{position:o,normal:l,tangent:a}=n;return{position:F(new Float64Array(o.length),o,r),tangent:a,normal:l}}const e=_(n,t.localMatrix);return F(e.position,e.position,r),e}function jn({vertexAttributes:n,spatialReference:r,transform:t},{origin:e},o,l){const a=L(r,l);if(!T(r,e,m,a))return A(g(),r,a),null;if(t&&U(m,m,t.localMatrix),!T(r,o,v,a))return A(g(),a,r),null;b(v,v);const i=U(m,v,m);return G(i,r,l,3),_(n,i)}function _(n,r){const t=new Float64Array(n.position.length);k(t,n.position,r);const e=n.normal?new Float32Array(n.normal.length):null,o=n.tangent?new Float32Array(n.tangent.length):null;return e&&n.normal&&tn(n.normal,e,r),o&&n.tangent&&en(n.tangent,o,r),{position:t,normal:e,tangent:o}}function kn(n,r,t,e,o){k(e,n,r);const l=new Float64Array(n.length);return Mn(e,o,l,t)?l:(A(g(),o,t),null)}function Ln(n,r,t,e,o,l){if(o==null)return null;const a=new Float32Array(o.length);return tn(o,a,l),En(a,n,r,t,e,a)?a:(A(g(),e,r),null)}function _n(n,r,t,e,o,l){if(o==null)return null;const a=new Float32Array(o.length);return en(o,a,l),bn(a,n,r,t,e,a)?a:(A(g(),e,r),null)}function G(n,r,t,e){const o=P(r,t,e);E(o)||C(n,n,[o,o,o])}function P(n,r,t){const e=!!(1&t),o=!!(2&t),l=r?.sourceUnit,a=r?.targetUnit;if(!l&&!a)return 1;let i=I(l,n);e||!l||E(i)||(g().warn("source unit conversion not supported"),i=1);let c=1/I(a,n);return o||!a||E(c)||(g().warn("target unit conversion not supported"),c=1),i*c}function E(n){return cn(n,1)}function Gn(n,r,t,e,o){const l=Sn(n,r,e,o);if(!l)return A(g(),r,o),null;const a=new Float64Array(l.length);return k(a,l,t),a}function Yn(n,r,t,e,o,l,a){if(n==null)return null;const i=a??new Float32Array(n.length);return Fn(n,r,t,e,o,i)?(j(i,i,l),i):(A(g(),t,o),null)}function On(n,r,t,e,o,l,a){if(n==null)return null;const i=a??new Float32Array(n.length);return Rn(n,r,t,e,o,i)?(j(i,i,l,4),i):(A(g(),t,o),null)}function I(n,r){if(n==null)return 1;const t=pn(r);return 1/mn(t,"meters",n)}const m=R(),v=R(),qn=K(),on=V(),J=R();export{Rn as F,En as M,rr as P,Sn as V,bn as a,nr as b,A as k,I as n,tr as q,Fn as w,Mn as x};
