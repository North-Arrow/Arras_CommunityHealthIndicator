import{_ as l,z as r,A as y,B as x,g as V,aE as q,dc as R,P as F,dT as Ze,ci as me,ho as Me,U as v,N as J,hc as mt,gT as vt,gd as Qe,eR as bt,cp as gt,s as Xe,i as wt,J as Vt,hp as N,hn as Be,ix as St,c2 as xt,iy as Ne,iz as Ke,gS as ie,gt as zt,eF as _t,cV as It,a$ as $t,M as Ve,cX as jt,c$ as Ft,di as Ye,iA as et,aH as ye,eL as qt,bj as be,aW as tt}from"./MapPage-ILsU69jC.js";import{y as Et}from"./diffUtils-CQPMgGN0.js";import{a as kt,d as it}from"./RendererLegendOptions-D8Z4S6Qe.js";import{i as Tt}from"./styleUtils-Ds_HJ2po.js";import{p as Ot,m as Dt}from"./colorRamps-wjB4Ho5G.js";import{i as Ut}from"./OperationalLayer-BEv3MRwb.js";import{i as fe}from"./jsonUtils-BkCEHgCI.js";var Se;let X=Se=class extends x{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new Se({minValue:this.minValue,maxValue:this.maxValue})}};l([r({type:Number,json:{write:!0}})],X.prototype,"minValue",void 0),l([r({type:Number,json:{write:!0}})],X.prototype,"maxValue",void 0),X=Se=l([y("esri.renderers.support.AuthoringInfoClassBreakInfo")],X);var xe;let D=xe=class extends x{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new xe({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:V(this.classBreakInfos)})}};l([r({type:String,json:{write:!0}})],D.prototype,"field",void 0),l([r({type:String,json:{write:!0}})],D.prototype,"normalizationField",void 0),l([r({type:String,json:{write:!0}})],D.prototype,"label",void 0),l([r({type:[X],json:{write:!0}})],D.prototype,"classBreakInfos",void 0),D=xe=l([y("esri.renderers.support.AuthoringInfoFieldInfo")],D);var ze;let L=ze=class extends x{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new ze({label:this.label,value:this.value,size:this.size})}};l([r({type:String,json:{write:!0}})],L.prototype,"label",void 0),l([r({type:Number,json:{write:!0}})],L.prototype,"size",void 0),l([r({type:Number,json:{write:!0}})],L.prototype,"value",void 0),L=ze=l([y("esri.renderers.support.AuthoringInfoSizeStop")],L);const Mt=L;var _e;const se=new q({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),le=new q({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Re={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Ce=["high-to-low","above-and-below","centered-on","extremes"],Ge=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size","spike"])],Ae=["seconds","minutes","hours","days","months","years"],Bt=["circle","diamond","hexagon-flat","hexagon-pointy","square"],Nt=["triangle-closed-outline","triangle-gradient-fill-closed","triangle-gradient-fill-closed-outline","triangle-gradient-fill-open","triangle-gradient-fill-open-outline","triangle-open-outline","triangle-solid-fill-closed","triangle-solid-fill-closed-outline","triangle-solid-fill-open","triangle-solid-fill-open-outline"];let w=_e=class extends x{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}get normalizationField(){return this.theme==="reference-size"||this.theme==="spike"?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}get spikeSymbolStyle(){return this.theme==="spike"?this._get("spikeSymbolStyle"):null}set spikeSymbolStyle(e){this._set("spikeSymbolStyle",e)}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get sizeStops(){return this.theme==="reference-size"||this.theme==="spike"?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new _e({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,spikeSymbolStyle:this.spikeSymbolStyle,sizeStops:V(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};l([r({types:Re,json:{write:!0}})],w.prototype,"endTime",void 0),l([R("endTime")],w.prototype,"castEndTime",null),l([r({type:String,json:{write:!0}})],w.prototype,"field",void 0),l([r({type:Number,json:{write:!0}})],w.prototype,"maxSliderValue",void 0),l([r({type:Number,json:{write:!0}})],w.prototype,"minSliderValue",void 0),l([r({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"normalizationField",null),l([r({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"referenceSizeScale",null),l([r({type:Bt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"referenceSizeSymbolStyle",null),l([r({type:Nt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"spikeSymbolStyle",null),l([r({types:Re,json:{write:!0}})],w.prototype,"startTime",void 0),l([R("startTime")],w.prototype,"castStartTime",null),l([r({type:[Mt],json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"sizeStops",null),l([r({type:se.apiValues,value:null,json:{type:se.jsonValues,read:se.read,write:se.write}})],w.prototype,"style",null),l([r({type:Ge,value:null,json:{type:Ge,origins:{"web-scene":{type:Ce,write:{writer:(e,t)=>{Ce.includes(e)&&(t.theme=e)}}}},write:!0}})],w.prototype,"theme",null),l([r({type:le.apiValues,json:{type:le.jsonValues,read:le.read,write:le.write}})],w.prototype,"type",void 0),l([r({type:Ae,json:{type:Ae,write:!0}})],w.prototype,"units",void 0),w=_e=l([y("esri.renderers.support.AuthoringInfoVisualVariable")],w);const Rt=w;var Ie;const C=new q({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),re=new q({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Le=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"],Ct=["high-to-low","above-and-below","above","below"],Gt=["flow-line","wave-front"],At=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let f=Ie=class extends x{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?Ot(e):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new Ie({classificationMethod:this.classificationMethod,colorRamp:V(this.colorRamp),fadeRatio:V(this.fadeRatio),fields:this.fields?.slice(),field1:V(this.field1),field2:V(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};l([r({type:C.apiValues,value:null,json:{type:C.jsonValues,read:C.read,write:C.write,origins:{"web-document":{default:"manual",type:C.jsonValues,read:C.read,write:C.write}}}})],f.prototype,"classificationMethod",null),l([r({types:Dt,json:{write:!0}})],f.prototype,"colorRamp",void 0),l([F("colorRamp")],f.prototype,"readColorRamp",null),l([r({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],f.prototype,"fadeRatio",void 0),l([r({type:[String],value:null,json:{write:!0}})],f.prototype,"fields",null),l([r({type:D,value:null,json:{write:!0}})],f.prototype,"field1",null),l([r({type:D,value:null,json:{write:!0}})],f.prototype,"field2",null),l([r({type:Gt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],f.prototype,"flowTheme",null),l([r({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],f.prototype,"focus",null),l([r({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],f.prototype,"isAutoGenerated",void 0),l([r({type:Number,value:null,json:{type:Ze,write:!0}})],f.prototype,"numClasses",null),l([r({type:Le,json:{type:Le,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],f.prototype,"lengthUnit",void 0),l([r({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],f.prototype,"maxSliderValue",void 0),l([r({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],f.prototype,"minSliderValue",void 0),l([r({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],f.prototype,"statistics",null),l([r({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],f.prototype,"standardDeviationInterval",null),l([r({type:re.apiValues,value:null,json:{type:re.jsonValues,read:re.read,write:re.write}})],f.prototype,"type",null),l([r({type:[Rt],json:{write:!0}})],f.prototype,"visualVariables",void 0),l([r({type:At,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],f.prototype,"univariateSymbolStyle",null),l([r({type:Ct,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],f.prototype,"univariateTheme",null),f=Ie=l([y("esri.renderers.support.AuthoringInfo")],f);const ge=new q({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let H=class extends x{constructor(t){super(t),this.authoringInfo=null,this.type=null}async getRequiredFields(t){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,t),Array.from(i).sort()}getSymbol(t,i){}async getSymbolAsync(t,i){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};l([r({type:f,json:{write:!0}})],H.prototype,"authoringInfo",void 0),l([r({type:ge.apiValues,readOnly:!0,json:{type:ge.jsonValues,read:!1,write:{writer:ge.write,ignoreOrigin:!0,isRequired:!0}}})],H.prototype,"type",void 0),H=l([y("esri.renderers.Renderer")],H);let K=class extends me(x){constructor(){super(...arguments),this.showLegend=null,this.title=null}};l([r({type:Boolean,json:{write:!0}})],K.prototype,"showLegend",void 0),l([r({type:String,json:{write:!0}})],K.prototype,"title",void 0),K=l([y("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],K);const st=K,we=new q({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let S=class extends x{constructor(t){super(t),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(t){return t==null?t:typeof t=="function"?(v.getLogger(this).error(".field: field must be a string value"),null):Me(t)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};l([r()],S.prototype,"index",void 0),l([r({type:we.apiValues,readOnly:!0,json:{read:we.read,write:{writer:we.write,isRequired:!0}}})],S.prototype,"type",void 0),l([r({type:String,json:{write:!0}})],S.prototype,"field",void 0),l([R("field")],S.prototype,"castField",null),l([r({type:String,json:{write:!0}})],S.prototype,"valueExpression",void 0),l([r({type:String,json:{write:!0}})],S.prototype,"valueExpressionTitle",void 0),l([r({readOnly:!0})],S.prototype,"arcadeRequired",null),l([r({type:st,json:{write:!0}})],S.prototype,"legendOptions",void 0),S=l([y("esri.renderers.visualVariables.VisualVariable")],S);var $e;let U=$e=class extends S{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new $e({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};l([r({readOnly:!0})],U.prototype,"cache",null),l([r({type:["color"],json:{type:["colorInfo"]}})],U.prototype,"type",void 0),l([r({type:String,json:{write:!0}})],U.prototype,"normalizationField",void 0),l([r({type:[kt],json:{write:!0}})],U.prototype,"stops",null),U=$e=l([y("esri.renderers.visualVariables.ColorVariable")],U);var je;let T=je=class extends x{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return mt(t.transparency)}writeOpacity(e,t,i){t[i]=vt(e)}clone(){return new je({label:this.label,opacity:this.opacity,value:this.value})}};l([r({type:String,json:{write:!0}})],T.prototype,"label",void 0),l([r({type:Number,json:{type:Ze,write:{target:"transparency",isRequired:!0}}})],T.prototype,"opacity",void 0),l([F("opacity",["transparency"])],T.prototype,"readOpacity",null),l([J("opacity")],T.prototype,"writeOpacity",null),l([r({type:Number,json:{write:{isRequired:!0}}})],T.prototype,"value",void 0),T=je=l([y("esri.renderers.visualVariables.support.OpacityStop")],T);const Lt=T;var Fe;let M=Fe=class extends S{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new Fe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};l([r({readOnly:!0})],M.prototype,"cache",null),l([r({type:["opacity"],json:{type:["transparencyInfo"]}})],M.prototype,"type",void 0),l([r({type:String,json:{write:!0}})],M.prototype,"normalizationField",void 0),l([r({type:[Lt],json:{write:!0}})],M.prototype,"stops",null),M=Fe=l([y("esri.renderers.visualVariables.OpacityVariable")],M);var qe;let B=qe=class extends S{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new qe({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};l([r({readOnly:!0})],B.prototype,"cache",null),l([r({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],B.prototype,"axis",void 0),l([r({type:["rotation"],json:{type:["rotationInfo"]}})],B.prototype,"type",void 0),l([r({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],B.prototype,"rotationType",void 0),B=qe=l([y("esri.renderers.visualVariables.RotationVariable")],B);function Ht(e){return Qe(e)}var Ee;let O=Ee=class extends x{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new Ee({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};l([r({type:String,json:{write:!0}})],O.prototype,"label",void 0),l([r({type:Number,cast:Qe,json:{write:{isRequired:!0}}})],O.prototype,"size",void 0),l([r({type:Number,json:{write:{isRequired:!0}}})],O.prototype,"value",void 0),l([r({type:Boolean,json:{write:!1}})],O.prototype,"useMinValue",void 0),l([r({type:Boolean,json:{write:!1}})],O.prototype,"useMaxValue",void 0),O=Ee=l([y("esri.renderers.visualVariables.support.SizeStop")],O);let oe=class extends st{constructor(){super(...arguments),this.customValues=null}};l([r({type:[Number],json:{write:!0}})],oe.prototype,"customValues",void 0),oe=l([y("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],oe);const Pt=oe;function P(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function ee(e){return e!=null&&!isNaN(e)&&isFinite(e)}function lt(e){return e.valueExpression?"expression":e.field&&typeof e.field=="string"?"field":"unknown"}function Jt(e,t){const i=t||lt(e),s=e.valueUnit||"unknown";return i==="unknown"?"constant":e.stops?"stops":e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?"clamped-linear":s==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}const rt=()=>v.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),at=e=>rt().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),nt=()=>rt().error("Use of arcade expressions requires an arcade context");new gt;const ue=Math.PI,Wt=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function zi(e,t,i){const s="visualVariables"in e?e.visualVariables?.find(z=>z.type==="rotation"):e;if(!s)return;if(s.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void at("RotationVariable");const a=s.axis||"heading",n=a==="heading"&&s.rotationType==="arithmetic"?90:0,o=a==="heading"&&s.rotationType==="arithmetic"?-1:1,p=typeof t=="number"?null:t,u=p?.attributes,h=s.field,{hasExpression:b}=s.cache;s.cache.compiledFunc;let m=null;return!h&&!b?m:b?void nt():(u&&(m=u[h]),m=typeof m!="number"||isNaN(m)?null:n+o*m,m)}function Zt(e,t,i){const s=typeof t=="number",a=s?null:t,n=a?.attributes;let o=s?t:null;const{isScaleDriven:p}=e.cache;if(e.cache.compiledFunc,p)o=Qt(e);else if(!s)switch(e.inputValueType){case"expression":return void nt();case"field":n&&(o=n[e.field]);break;case"unknown":o=null}if(!ee(o))return null;if(s||!e.normalizationField)return o;const u=n?parseFloat(n[e.normalizationField]):null;return ee(u)&&u!==0?o/u:null}function Qt(e){let t=null,i=null;const s=e.stops;return s?(t=s[0].value,i=s[s.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function ot(e,t,i){const s="visualVariables"in e?e.visualVariables?.find(n=>n.type==="size"):e;if(!s)return;if(s.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void at("SizeVariable");const a=si(Zt(s,t),s,t,i,s.cache.ipData);return a==null||isNaN(a)?void 0:a}function j(e,t,i){return e==null?null:P(e)?ot(e,t,i):ee(e)?e:null}function ut(e,t,i){return ee(i)&&e>i?i:ee(t)&&e<t?t:e}function Xt(e,t,i,s){const a=j(t.minSize,i,s)||t.minDataValue;return e==null&&a==null?null:(e??0)+(a??0)}function Kt(e,t,i){const s=e.stops;let a=s?.length&&s[0].size;return a==null&&(a=e.minSize),j(a,t,i)}function Yt(e,t,i,s){const a=j(t.minSize,i,s);if(e==null)return a;const{minDataValue:n,maxDataValue:o}=t;if(n==null||o==null)return null;const p=(e-n)/(o-n),u=j(t.maxSize,i,s),h=s?.shape;if(e<=n)return a;if(e>=o)return u;if(a==null||u==null)return null;if(t.scaleBy==="area"&&h){const b=h==="circle",m=b?ue*(a/2)**2:a*a,z=m+p*((b?ue*(u/2)**2:u*u)-m);return b?2*Math.sqrt(z/ue):Math.sqrt(z)}return a+p*(u-a)}function ei(e,t,i,s){const a=j(t.minSize,i,s);if(e==null||a==null)return a;const{minDataValue:n}=t;if(n==null)return null;const o=e/n,p=j(t.maxSize,i,s);let u=null;return u=o*a,ut(u,a,p)}function ti(e,t,i,s,a){if(e==null)return null;const[n,o,p]=li(e,a);if(n===o)return j(t.stops?.[n].size,i,s);{const u=j(t.stops?.[n].size,i,s),h=j(t.stops?.[o].size,i,s);return u==null||h==null?null:u+(h-u)*p}}function ii(e,t,i,s){const a=1*Ut[t.valueUnit],n=j(t.minSize,i,s),o=j(t.maxSize,i,s),{valueRepresentation:p}=t;if(e==null)return n;let u=null;return u=p==="area"?2*Math.sqrt(e/ue)/a:p==="radius"||p==="distance"?2*e/a:e/a,ut(u,n,o)}function si(e,t,i,s,a){switch(t.transformationType){case"additive":return Xt(e,t,i,s);case"constant":return Kt(t,i,s);case"clamped-linear":return Yt(e,t,i,s);case"proportional":return ei(e,t,i,s);case"stops":return ti(e,t,i,s,a);case"real-world-size":return ii(e,t,i,s);case"identity":return e;case"unknown":return null}}function li(e,t){if(!t)return;let i=0,s=t.length-1;return t.some((a,n)=>e<a?(s=n,!0):(i=n,!1)),[i,s,(e-t[i])/(t[s]-t[i])]}function _i(e,t,i){const s=["proportional","proportional","proportional"];for(const a of e){const n=a.useSymbolValue?"symbol-value":ot(a,t,i)??"proportional";switch(a.axis){case"width":s[0]=n;break;case"depth":s[1]=n;break;case"height":s[2]=n;break;case"width-and-depth":s[0]=n,s[1]=n;break;case"all":case void 0:case null:s[0]=n,s[1]=n,s[2]=n;break;default:bt(a.axis)}}return s}var ke;const ae=new q({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Te=new q({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function He(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Ht(e):e.type==="size"?P(e)?e:(delete(e={...e}).type,new d(e)):void 0}function Pe(e,t,i){if(typeof e!="object")return e;const s=new d;return s.read(e,i),s}let d=ke=class extends S{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&Wt.test(this.valueExpression)}}set index(e){P(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),P(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return lt(this)}set maxDataValue(e){e&&this.stops&&(v.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(v.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return He(e)}readMaxSize(e,t,i){return Pe(e,t,i)}set minDataValue(e){e&&this.stops&&(v.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(v.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return He(e)}readMinSize(e,t,i){return Pe(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(v.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return Jt(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,s){if(e==="$view.scale"){if(s?.messages){const a=this.index,n=typeof a=="string"?a:`visualVariables[${a}]`;s.messages.push(new Xe("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:s}))}}else t[i]=e}readValueUnit(e){return e?Te.read(e):null}clone(){return new ke({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:P(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:P(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType==="clamped-linear"){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType==="stops"){const e=this.stops;if(!e)return this;const t=e.map(s=>s.size).reverse(),i=e.length;for(let s=0;s<i;s++)e[s].size=t[s];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(e=>e.value||0)}};l([r({readOnly:!0})],d.prototype,"cache",null),l([r({type:ae.apiValues,json:{type:ae.jsonValues,origins:{"web-map":{read:!1}},read:ae.read,write:ae.write}})],d.prototype,"axis",void 0),l([r()],d.prototype,"index",null),l([r({type:String,readOnly:!0})],d.prototype,"inputValueType",null),l([r({type:Pt,json:{write:!0}})],d.prototype,"legendOptions",void 0),l([r({type:Number,value:null,json:{write:!0}})],d.prototype,"maxDataValue",null),l([r({type:Number,value:null,json:{write:!0}})],d.prototype,"maxSize",null),l([R("maxSize")],d.prototype,"castMaxSize",null),l([F("maxSize")],d.prototype,"readMaxSize",null),l([r({type:Number,value:null,json:{write:!0}})],d.prototype,"minDataValue",null),l([r({type:Number,value:null,json:{write:!0}})],d.prototype,"minSize",null),l([R("minSize")],d.prototype,"castMinSize",null),l([F("minSize")],d.prototype,"readMinSize",null),l([r({type:String,json:{write:!0}})],d.prototype,"normalizationField",void 0),l([r({readOnly:!0})],d.prototype,"arcadeRequired",null),l([r({type:String})],d.prototype,"scaleBy",void 0),l([r({type:[O],value:null,json:{write:!0}})],d.prototype,"stops",null),l([r({type:["outline"],json:{write:!0}})],d.prototype,"target",void 0),l([r({type:String,readOnly:!0})],d.prototype,"transformationType",null),l([r({type:["size"],json:{type:["sizeInfo"]}})],d.prototype,"type",void 0),l([r({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],d.prototype,"useSymbolValue",void 0),l([r({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),l([F("valueExpression",["valueExpression","expression"])],d.prototype,"readValueExpression",null),l([J("web-scene","valueExpression")],d.prototype,"writeValueExpressionWebScene",null),l([r({type:["radius","diameter","area","width","distance"],json:{write:!0}})],d.prototype,"valueRepresentation",void 0),l([r({type:Te.apiValues,json:{write:Te.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],d.prototype,"valueUnit",void 0),l([F("valueUnit")],d.prototype,"readValueUnit",null),d=ke=l([y("esri.renderers.visualVariables.SizeVariable")],d);const ri={color:U,size:d,opacity:M,rotation:B},ai=new q({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),ni=/^\[([^\]]+)\]$/i;let pe=class extends wt{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(t){if(this._resetVariables(),t=t?.filter(i=>!!i),t?.length){for(const i of t)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&t.sort((i,s)=>{let a=null;return a=i.target===s.target?0:i.target?1:-1,a});for(let i=0;i<t.length;i++)t[i].index=i;this._set("visualVariables",t)}else this._set("visualVariables",t)}readVariables(t,i,s){const{rotationExpression:a,rotationType:n}=i,o=a?.match(ni),p=o?.[1];if(p&&(t||(t=[]),t.push({type:"rotationInfo",rotationType:n,field:p})),t)return t.map(u=>{const h=ai.read(u.type),b=ri[h];b||(v.getLogger(this).warn(`Unknown variable type: ${h}`),s?.messages&&s.messages.push(new Vt("visual-variable:unsupported",`visualVariable of type '${h}' is not supported`,{definition:u,context:s})));const m=new b;return m.read(u,s),m})}writeVariables(t,i){const s=[];for(const a of t){const n=a.toJSON(i);n&&s.push(n)}return s}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};l([r()],pe.prototype,"visualVariables",null),pe=l([y("esri.renderers.visualVariables.VisualVariableFactory")],pe);const oi={base:S,key:"type",typeMap:{opacity:M,color:U,rotation:B,size:d}},pt=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this._vvFactory=new pe}set visualVariables(s){this._vvFactory.visualVariables=s,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(s,a,n){return this._vvFactory.readVariables(s,a,n)}writeVisualVariables(s,a,n,o){a[n]=this._vvFactory.writeVariables(s,o)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some(({arcadeRequired:s})=>s)??!1}hasVisualVariables(s,a){return s?this.getVisualVariablesForType(s,a).length>0:this.getVisualVariablesForType("size",a).length>0||this.getVisualVariablesForType("color",a).length>0||this.getVisualVariablesForType("opacity",a).length>0||this.getVisualVariablesForType("rotation",a).length>0}getVisualVariablesForType(s,a){return this.visualVariables?.filter(n=>n.type===s&&(typeof a=="string"?n.target===a:a!==!1||!n.target))??[]}async collectVVRequiredFields(s,a){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const o of n)o&&(o.field&&N(s,a,o.field),o.normalizationField&&N(s,a,o.normalizationField),o.valueExpression&&(ui(o.valueExpression,s,a)||await Be(s,a,null,o.valueExpression)))}};return l([r({types:[oi],value:null,json:{write:!0}})],i.prototype,"visualVariables",null),l([F("visualVariables",["visualVariables","rotationType","rotationExpression"])],i.prototype,"readVisualVariables",null),l([J("visualVariables")],i.prototype,"writeVisualVariables",null),i=l([y("esri.renderers.mixins.VisualVariablesMixin")],i),i};function ui(e,t,i){const s=St(e);return s!=null&&(N(t,i,s),!0)}const ve={types:zt,json:{write:{writer:fe},origins:{"web-scene":{types:Ne,write:{writer:fe},read:{reader:xt({types:Ne})}}}}},dt=Ke({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},ve),ht={types:{base:It,key:"type",typeMap:{"simple-fill":ie.typeMap["simple-fill"],"picture-fill":ie.typeMap["picture-fill"],"polygon-3d":ie.typeMap["polygon-3d"],cim:ie.typeMap.cim}},json:{write:{writer:fe},origins:{"web-scene":{type:_t,write:{writer:fe}}}}},de={cast:e=>e==null||typeof e=="string"||typeof e=="number"?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}};let $=class extends me(x){constructor(t){super(t),this.value=null,this.value2=null,this.value3=null}};l([r(de)],$.prototype,"value",void 0),l([r(de)],$.prototype,"value2",void 0),l([r(de)],$.prototype,"value3",void 0),$=l([y("esri.renderers.support.UniqueValue")],$);let E=class extends me(x){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(i=>new $({value:i})):t==="object"?e[0]instanceof $?e:e.map(i=>new $(i)):null}};l([r({type:String,json:{write:!0}})],E.prototype,"description",void 0),l([r({type:String,json:{write:!0}})],E.prototype,"label",void 0),l([r(ve)],E.prototype,"symbol",void 0),l([r({type:[$],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new $({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{const i=[];for(const s of e){const a=[s.value,s.value2,s.value3].filter($t).map(n=>n.toString());i.push(a)}t.values=i}}}})],E.prototype,"values",void 0),l([R("values")],E.prototype,"castValues",null),E=l([y("esri.renderers.support.UniqueValueClass")],E);let G=class extends me(x){constructor(t){super(t),this.heading=null,this.classes=null}};l([r({type:String,json:{write:!0}})],G.prototype,"heading",void 0),l([r({type:[E],json:{write:{isRequired:!0}}})],G.prototype,"classes",void 0),G=l([y("esri.renderers.support.UniqueValueGroup")],G);var Oe;let I=Oe=class extends x{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Oe({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};l([r({type:String,json:{write:!0}})],I.prototype,"description",void 0),l([r({type:String,json:{write:!0}})],I.prototype,"label",void 0),l([r(dt)],I.prototype,"symbol",void 0),l([r(de)],I.prototype,"value",void 0),I=Oe=l([y("esri.renderers.support.UniqueValueInfo")],I);var Y;const Je="uvInfos-watcher",We="uvGroups-watcher",pi=",",di=Ye(I);function hi(e){const{field1:t,field2:i,field3:s,fieldDelimiter:a,uniqueValueInfos:n,valueExpression:o}=e,p=!(!t||!i);return[{classes:(n??[]).map(u=>{const{symbol:h,label:b,value:m,description:z}=u,[W,Z,Q]=p?m?.toString()?.split(a||"")||[]:[m],k=[];return(t||o)&&k.push(W),i&&k.push(Z),s&&k.push(Q),{symbol:h,label:b,values:[k],description:z}})}]}function A(e){return e!=null&&e!==""&&(typeof e!="string"||e.trim()!==""&&e.toLowerCase()!=="<null>")||(e=null),e+""}let c=Y=class extends pt(H){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let s=!1;const a={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(p=>p.value===i[n].value);o?Et(o,i[n])?(a.changed.push({type:"complete",oldValue:o,newValue:i[n]}),s=!0):a.unchanged.push({oldValue:o,newValue:i[n]}):(a.added.push(i[n]),s=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(a.removed.push(t[n]),s=!0);return s?a:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:Me(e)}writeField(e,t,i,s){typeof e=="string"?t[i]=e:s?.messages?s.messages.push(new Xe("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):v.getLogger(this).error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,i){return i.portal||Ve.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const s=jt(t.styleUrl,i);return Object.freeze({styleUrl:s})}}writeStyleOrigin(e,t,i,s){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Ft(e.styleUrl,s))}set uniqueValueGroups(e){this.styleOrigin?v.getLogger(this).error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?v.getLogger(this).error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void v.getLogger(this).error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?di(e):new I({value:e,symbol:et(t)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[A(i.value)]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void v.getLogger(this).error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let i=0;i<t.length;i++){const s=t[i];if(String(s.value)===String(e)){delete this._valueInfoMap[A(e)],t.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&t?.arcade==null&&(i={...i,arcade:await ye()}),this._getUniqueValueInfo(e,i)}getSymbol(e,t){return this.valueExpression&&t?.arcade==null?void v.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(e,t)?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&i?.arcade==null){const a=await ye(),{arcadeUtils:n}=a;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:a}}return this._getUniqueValueInfo(e,i)?.symbol||this.defaultSymbol}get symbols(){const e=[];if(this._isInfosSource)for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);else for(const t of this.uniqueValueGroups??[])for(const i of t.classes??[])i.symbol&&e.push(i.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((s,a)=>s+a.getMeshHash(),"");return`${e}.${t}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new Y({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:V(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:V(this.visualVariables),legendOptions:V(this.legendOptions),authoringInfo:V(this.authoringInfo),backgroundFillSymbol:V(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=V(this.uniqueValueInfos),i=V(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(V(this.styleOrigin))),Object.freeze(t),Object.freeze(i)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",i),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.symbols.map(s=>s.collectRequiredFields(e,t)),Be(e,t,null,this.valueExpression)];N(e,t,this.field),N(e,t,this.field2),N(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return Tt(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const s=new qt({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const a=new I({value:i.name,symbol:s});t.push(a),this._valueInfoMap[A(i.name)]=a}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",pi)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[A(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Je);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const i of e)t.push(be(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(s,a)=>{s!==a&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,Je)}}_watchUniqueValueGroups(){this.removeHandles(We);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const i of e){t.push(be(()=>({classes:i.classes}),(s,a)=>{s!==a&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const s of i.classes??[])t.push(be(()=>({symbol:s.symbol,values:s.values,label:s.label,description:s.description}),(a,n)=>{a!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(t,We)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:i,field3:s,fieldDelimiter:a,uniqueValueGroups:n,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const p=!(!t||!i);for(const u of n)for(const h of u.classes??[]){const{symbol:b,label:m,values:z,description:W}=h;for(const Z of z??[]){const{value:Q,value2:k,value3:yt}=Z,te=[Q];i&&te.push(k),s&&te.push(yt);const ft=p?te.join(a||""):te[0]??void 0;e.push(new I({symbol:b,label:m,value:ft,description:W}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:i,valueExpression:s,fieldDelimiter:a,uniqueValueInfos:n}=this;if(!t&&!s||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!i),p=n.map(h=>{const{symbol:b,label:m,value:z,description:W}=h,[Z,Q,k]=o?z?.toString()?.split(a||"")||[]:[z];return new E({symbol:b,label:m,description:W,values:[new $({value:Z,value2:Q,value3:k})]})}),u=[new G({classes:p})];e&&Object.freeze(u),this._set("uniqueValueGroups",u),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:s,spatialReference:a,arcade:n,timeZone:o}=t??{};let p=this._cache.compiledFunc;const u=n.arcadeUtils;if(!p){const b=u.createSyntaxTree(this.valueExpression);p=u.createFunction(b),this._cache.compiledFunc=p}const h=u.executeFunction(p,u.createExecContext(e,u.getViewInfo({viewingMode:i,scale:s,spatialReference:a}),o));return this._valueInfoMap[A(h)]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let s;if(this.field2){const a=this.field2,n=this.field3,o=[];t&&o.push(i[t]),a&&o.push(i[a]),n&&o.push(i[n]),s=o.join(this.fieldDelimiter||"")}else t&&(s=i[t]);return this._valueInfoMap[A(s)]}static fromPortalStyle(e,t){const i=new Y(t?.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t?.portal||Ve.getDefault());const s=i.populateFromStyle();return s.catch(a=>{v.getLogger(this.prototype).error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",a)}),s}static fromStyleUrl(e,t){const i=new Y(t?.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const s=i.populateFromStyle();return s.catch(a=>{v.getLogger(this.prototype).error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",a)}),s}};l([r({readOnly:!0})],c.prototype,"_cache",null),l([tt({uniqueValue:"unique-value"})],c.prototype,"type",void 0),l([r(ht)],c.prototype,"backgroundFillSymbol",void 0),l([r({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],c.prototype,"field",null),l([R("field")],c.prototype,"castField",null),l([J("field")],c.prototype,"writeField",null),l([r({type:String,value:null,json:{write:!0}})],c.prototype,"field2",null),l([r({type:String,value:null,json:{write:!0}})],c.prototype,"field3",null),l([r({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],c.prototype,"orderByClassesEnabled",void 0),l([r({type:String,value:null,json:{write:!0}})],c.prototype,"valueExpression",null),l([r({type:String,json:{write:!0}})],c.prototype,"valueExpressionTitle",void 0),l([r({type:it,json:{write:!0}})],c.prototype,"legendOptions",void 0),l([r({type:String,json:{write:!0}})],c.prototype,"defaultLabel",void 0),l([r(Ke({...ve},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],c.prototype,"defaultSymbol",null),l([r({type:String,value:null,json:{write:!0}})],c.prototype,"fieldDelimiter",null),l([r({type:Ve,readOnly:!0})],c.prototype,"portal",void 0),l([F("portal",["styleName"])],c.prototype,"readPortal",null),l([r({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],c.prototype,"styleOrigin",void 0),l([F("styleOrigin",["styleName","styleUrl"])],c.prototype,"readStyleOrigin",null),l([J("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],c.prototype,"writeStyleOrigin",null),l([r({type:[G],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,i)=>(t.uniqueValueGroups||hi(t)).map(s=>G.fromJSON(s,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],c.prototype,"uniqueValueGroups",null),l([r({type:[I],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],c.prototype,"uniqueValueInfos",null),c=Y=l([y("esri.renderers.UniqueValueRenderer")],c);var De;let _=De=class extends x{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new De({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};l([r({type:String,json:{write:!0}})],_.prototype,"description",void 0),l([r({type:String,json:{write:!0}})],_.prototype,"label",void 0),l([r({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],_.prototype,"minValue",void 0),l([r({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],_.prototype,"maxValue",void 0),l([r(dt)],_.prototype,"symbol",void 0),_=De=l([y("esri.renderers.support.ClassBreakInfo")],_);var Ue;const ct="log",he="percent-of-total",ce="field",ne=new q({esriNormalizeByLog:ct,esriNormalizeByPercentOfTotal:he,esriNormalizeByField:ce}),ci=Ye(_);let g=Ue=class extends pt(H){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let s=t.minValue;return e.map(a=>{const n=new _;return n.read(a,i),n.minValue==null&&(n.minValue=s),n.maxValue==null&&(n.maxValue=n.minValue),s=n.maxValue,n})}writeClassBreakInfos(e,t,i,s){const a=e.map(n=>n.write({},s));this._areClassBreaksConsecutive()&&a.forEach(n=>delete n.classMinValue),t[i]=a}castField(e){return e==null?e:typeof e=="function"?(v.getLogger(this).error(".field: field must be a string value"),null):Me(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&ce||i&&he||null,t&&i&&v.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==ce&&e!==he||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let s=null;s=typeof e=="number"?new _({minValue:e,maxValue:t,symbol:et(i)}):ci(V(e)),this.classBreakInfos.push(s),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let s=0;s<i;s++){const a=[this.classBreakInfos[s].minValue,this.classBreakInfos[s].maxValue];if(a[0]===e&&a[1]===t){this.classBreakInfos.splice(s,1);break}}}getBreakIndex(e,t){return this.valueExpression&&t?.arcade==null&&v.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&t?.arcade==null&&(i={...i,arcade:await ye()});const s=this.getBreakIndex(e,i);return s!==-1?this.classBreakInfos[s]:null}getSymbol(e,t){if(this.valueExpression&&t?.arcade==null)return void v.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&t?.arcade==null){const a=await ye(),{arcadeUtils:n}=a;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:a}}const s=this.getBreakIndex(e,i);return s>-1?this.classBreakInfos[s].symbol:this.defaultSymbol}get symbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((s,a)=>s+a.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Ue({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:V(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:V(this.visualVariables),legendOptions:V(this.legendOptions),authoringInfo:V(this.authoringInfo)})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.symbols.map(s=>s.collectRequiredFields(e,t)),Be(e,t,null,this.valueExpression)];N(e,t,this.field),N(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:s,spatialReference:a,arcade:n,timeZone:o}=t??{},{valueExpression:p}=this;let u=this._compiledValueExpression.valueExpression===p?this._compiledValueExpression.compiledFunction:null;const h=n.arcadeUtils;if(!u){const m=h.createSyntaxTree(p);u=h.createFunction(m),this._compiledValueExpression.compiledFunction=u}this._compiledValueExpression.valueExpression=p;const b=h.executeFunction(u,h.createExecContext(e,h.getViewInfo({viewingMode:i,scale:s,spatialReference:a}),o));return this._getBreakIndexfromInfos(b)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,s=this.normalizationType;let a=parseFloat(i[t]);if(s){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(s===ct)a=Math.log(a)*Math.LOG10E;else if(s!==he||n==null||isNaN(n)){if(s===ce&&!isNaN(o)){if(isNaN(a)||isNaN(o))return-1;a/=o}}else a=a/n*100}return this._getBreakIndexfromInfos(a)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]<=e&&(t?e<=s[1]:e<s[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};l([r(ht)],g.prototype,"backgroundFillSymbol",void 0),l([r({type:[_],json:{write:{isRequired:!0}}})],g.prototype,"classBreakInfos",void 0),l([F("classBreakInfos")],g.prototype,"readClassBreakInfos",null),l([J("classBreakInfos")],g.prototype,"writeClassBreakInfos",null),l([r({type:String,json:{write:!0}})],g.prototype,"defaultLabel",void 0),l([r(ve)],g.prototype,"defaultSymbol",void 0),l([r({type:String,json:{write:!0}})],g.prototype,"field",void 0),l([R("field")],g.prototype,"castField",null),l([r({type:Boolean})],g.prototype,"isMaxInclusive",void 0),l([r({type:it,json:{write:!0}})],g.prototype,"legendOptions",void 0),l([r({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],g.prototype,"minValue",null),l([r({type:String,json:{write:!0}})],g.prototype,"normalizationField",void 0),l([r({type:Number,json:{write:!0}})],g.prototype,"normalizationTotal",void 0),l([r({type:ne.apiValues,value:null,json:{type:ne.jsonValues,read:ne.read,write:ne.write}})],g.prototype,"normalizationType",null),l([tt({classBreaks:"class-breaks"})],g.prototype,"type",void 0),l([r({type:String,json:{write:!0}})],g.prototype,"valueExpression",void 0),l([r({type:String,json:{write:!0}})],g.prototype,"valueExpressionTitle",void 0),g=Ue=l([y("esri.renderers.ClassBreaksRenderer")],g);export{c as $,_i as U,d as V,H as a,f as b,M as c,zi as d,_ as e,g as j,O as l,dt as m,ht as n,I as p,B as s,S as u,pt as v};
