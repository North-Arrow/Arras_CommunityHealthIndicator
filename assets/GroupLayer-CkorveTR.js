const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-BMyg6pFT.js","assets/utils-CRI8m_v8.js","assets/MapPage-Dnc0zaB7.js","assets/index-BR6_3zI-.js","assets/index-RQ3x4ZQ-.css","assets/themeLevelStore-PUX48y2-.js","assets/MapPage-kSfHLSm1.css","assets/originUtils-CPX8CCAY.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/PortalItem-B-2fiwKi.js","assets/jsonContext-Yka6KUk8.js","assets/portalItemUtils-CRJRLc31.js","assets/projectionUtils-v0NSj9sO.js","assets/saveUtils-XZjHR39e.js","assets/resourceUtils-CU55lzXe.js","assets/uuid-6RR-RRMo.js","assets/resourceUtils-CNc4trQg.js"])))=>i.map(i=>d[i]);
import{_ as w}from"./index-BR6_3zI-.js";import{_ as n,z as y,A as b,O as v,U as p,ep as g,cT as L,ac as I,d$ as $,bj as h,fl as O,bm as C,bn as c,f as M,bA as P,N as f,P as x}from"./MapPage-Dnc0zaB7.js";import{l as _}from"./CollectionFlattener-DzITNBlc.js";import{l as A}from"./loadAll-C0aMRGmz.js";import{l as T}from"./MultiOriginJSONSupport-CM9INbnd.js";import{p as S}from"./BlendLayer-BaJxPDpz.js";import{b as V}from"./OperationalLayer-Df5PZLzu.js";import{j as F}from"./PortalLayer-gZNVbMcS.js";import{t as E}from"./ScaleRangeLayer-QaB0osrq.js";import{populateGroupLayer as G}from"./layersCreator-CZAmKxaI.js";import{a as H}from"./lazyLayerLoader-DWlHp6HS.js";import R from"./PortalItem-B-2fiwKi.js";import{o as j}from"./saveUtils-XZjHR39e.js";import{y as B}from"./writeUtils-BL-1S0_C.js";import"./themeLevelStore-PUX48y2-.js";import"./asyncUtils-CWRDNBeS.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-BfceihvV.js";import"./portalItemUtils-CRJRLc31.js";import"./projectionUtils-v0NSj9sO.js";import"./loadUtils-CnQEwwRd.js";import"./fetchService-BzjVYdMM.js";import"./associatedFeatureServiceUtils-DrVuLzZI.js";import"./portalLayers-BgeLUGr2.js";import"./styleUtils-Czy3nm8u.js";function N(e){return new _({getCollections:()=>[e.tables,e.layers],getChildrenFunction:r=>{const i=[];return"tables"in r&&i.push(r.tables),"layers"in r&&i.push(r.layers),i},itemFilterFunction:r=>{const i=r.parent;return!!i&&"tables"in i&&i.tables.includes(r)}})}function u(e,r,i){let t,s;if(e)for(let a=0,l=e.length;a<l;a++){if(t=e.at(a),t?.[r]===i)return t;if(t?.type==="group"&&(s=u(t.layers,r,i),s))return s}}const U=e=>{const r=e;let i=class extends r{constructor(...t){super(...t),this.layers=new v;const s=o=>{o.parent&&o.removeFromParent()},a=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||p.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},l=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void p.getLogger(this).error("#add()","Cannot add layer to itself.");s(o.item)}),this.layers.on("after-add",o=>a(o.item)),this.layers.on("after-remove",o=>l(o.item))])}destroy(){const t=this.layers.toArray();for(const s of t)s.destroy();this.layers.destroy()}removeChildLayer(t){this.layers.remove(t),super.removeChildLayer?.(t)}set layers(t){this._set("layers",g(t,this._get("layers")))}add(t,s){const a=this.layers;if(s=a.getNextIndex(s),t instanceof L){const l=t;l.parent===this?this.reorder(l,s):a.add(l,s)}else I(t)?t.then(l=>{this.destroyed||this.add(l,s)}):p.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(t,s){const a=this.layers;let l=a.getNextIndex(s);t.slice().forEach(o=>{o.parent!==this?(a.add(o,l),l+=1):this.reorder(o,l)})}findLayerById(t){return u(this.layers,"id",t)}findLayerByUid(t){return u(this.layers,"uid",t)}remove(t){return this.layers.remove(t)}removeMany(t){return this.layers.removeMany(t)}removeAll(){return this.layers.removeAll()}reorder(t,s){return this.layers.reorder(t,s)}layerAdded(t){}layerRemoved(t){}};return n([y()],i.prototype,"layers",null),i=n([b("esri.support.LayersMixin")],i),i},k=new Set(["feature","subtype-group"]);function m(e,r,i){if(e)for(let t=0,s=e.length;t<s;t++){const a=e.at(t);if(a[r]===i)return a;if(a?.type==="group"){const l=m(a.tables,r,i);if(l)return l}}}const z=e=>{const r=e;let i=class extends r{constructor(...t){super(...t),this.tables=new v,this.addHandles([this.tables.on("after-add",s=>{const a=s.item;a.parent&&a.parent!==this&&a.removeFromParent(),a.parent=this,k.has(a.type)||p.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const t=this.tables.toArray();for(const s of t)s.destroy();this.tables.destroy()}removeChildLayer(t){this.tables.remove(t),super.removeChildLayer?.(t)}set tables(t){this._set("tables",g(t,this._get("tables")))}findTableById(t){return m(this.tables,"id",t)}findTableByUid(t){return m(this.tables,"uid",t)}};return n([y()],i.prototype,"tables",null),i=n([b("esri.support.TablesMixin")],i),i},D=Symbol("WebScene");let d=class extends S(E(V(F(z(U(T(L))))))){constructor(e){super(e),this.allLayers=new _({getCollections:()=>[this.layers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=N(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=$(async(r,i,t)=>{const{save:s,saveAs:a}=await w(()=>import("./groupLayerUtils-BMyg6pFT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]));switch(r){case 0:return s(this,i);case 1:return a(this,t,i)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([h(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&D in e},e=>{const r="prevent-adding-tables";this.removeHandles(r),e&&(this.tables.removeAll(),this.addHandles(C(()=>this.tables,"before-add",i=>{i.preventDefault(),p.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),r))},O),h(()=>this.visible,this._onVisibilityChange.bind(this),c)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===7}_writeLayers(e,r,i,t){const s=[];if(!e)return s;e.forEach(a=>{const l=B(a,t.webmap?t.webmap.getLayerJSONFromResourceInfo(a):null,t);l?.layerType&&s.push(l)}),r.layers=s}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,r,i){const{itemId:t,layerType:s}=r;if(s==="GroupLayer"&&t)return new R({id:t,portal:i?.portal})}writePortalItem(e,r){e?.id&&(r.itemId=e.id)}set visibilityMode(e){const r=this._get("visibilityMode")!==e;this._set("visibilityMode",e),r&&this._enforceVisibility(e,this.visible)}async beforeSave(){return j(this)}load(e){const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service","Video Service"],layerModuleTypeMap:H,populateGroupLayer:G},e).catch(i=>{if(M(i),this.sourceIsPortalItem)throw i});return this.addResolvingPromise(r),Promise.resolve(this)}async loadAll(){return A(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,r){return this._debouncedSaveOperations(1,r,e)}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(h(()=>e.visible,r=>this._onChildVisibilityChange(e,r),c),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(r=>{r!==e&&(r.visible=!1)})}_enforceVisibility(e,r){if(!P(this).initialized)return;const i=this.layers;let t=i.find(s=>s.visible);switch(e){case"exclusive":i.length&&!t&&(t=i.at(0),t.visible=!0),this._turnOffOtherLayers(t);break;case"inherited":i.forEach(s=>{s.visible=r})}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach(r=>{r.visible=e})}_onChildVisibilityChange(e,r){switch(this.visibilityMode){case"exclusive":r?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};n([y({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),n([y({readOnly:!0})],d.prototype,"allTables",void 0),n([y({json:{read:!0,write:!0}})],d.prototype,"blendMode",void 0),n([y()],d.prototype,"fullExtent",void 0),n([y({readOnly:!0})],d.prototype,"sourceIsPortalItem",null),n([y({json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"layers",void 0),n([f("layers")],d.prototype,"_writeLayers",null),n([y({type:["GroupLayer"]})],d.prototype,"operationalLayerType",void 0),n([y({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,r,i){return{enabled:e?.type==="Group Layer"&&i?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],d.prototype,"portalItem",null),n([x("web-map","portalItem",["itemId"])],d.prototype,"readPortalItem",null),n([f("web-map","portalItem",{itemId:{type:String}})],d.prototype,"writePortalItem",null),n([y()],d.prototype,"spatialReference",void 0),n([y({json:{read:!1},readOnly:!0,value:"group"})],d.prototype,"type",void 0),n([y({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,r,i)=>{e!=="inherited"&&(r[i]=e)}}}}})],d.prototype,"visibilityMode",null),d=n([b("esri.layers.GroupLayer")],d);const fe=d;export{fe as default};
