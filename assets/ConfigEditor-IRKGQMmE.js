import{b as oe,c as $,r as q,p as de,f as r,k as d,o as i,F as M,e as S,w as n,g as l,h as y,t as D,l as B,j as v,q as me,m as se,s as pe,i as ce,a as te,v as ae}from"./index-DtWsY0yY.js";const fe={class:"json-form-field"},ve={key:1},_e={key:0,class:"mb-4 maplibre-expression-textarea"},Ve={key:2},ge={key:0,class:"mb-4"},ye={key:1,class:"mb-4"},he={key:2,class:"mb-4"},be={key:3,class:"mb-4"},Ce={key:4,class:"mb-4"},we={key:5,class:"mb-4"},Ne=oe({__name:"JsonFormField",props:{modelValue:{},fieldName:{default:""},parentPath:{default:""},isNested:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(le,{emit:x}){const o=le,_=x,L=$(()=>o.parentPath?`${o.parentPath}.${o.fieldName}`:o.fieldName),m=$(()=>{if(o.parentPath?.includes("indicators")&&typeof o.modelValue=="object"&&o.modelValue!==null){if(o.modelValue.title)return o.modelValue.title;if(o.modelValue.short_name)return o.modelValue.short_name}return o.fieldName||"Root"}),g=$(()=>{const e=typeof o.modelValue;return e==="object"&&o.modelValue!==null?Array.isArray(o.modelValue)?"Array":"Object":e.charAt(0).toUpperCase()+e.slice(1)}),w=$(()=>typeof o.modelValue=="boolean"),h=$(()=>typeof o.modelValue=="number"),I=$(()=>{if(typeof o.modelValue!="string")return!1;const e=o.fieldName?.toLowerCase()||"",a=o.modelValue.toString().toLowerCase().trim();return e.includes("color")||e.includes("colour")?!0:/^#[0-9a-f]{3,8}$/i.test(a)||/^rgb\(/i.test(a)||/^rgba\(/i.test(a)||/^hsl\(/i.test(a)||/^hsla\(/i.test(a)}),T=$(()=>{if(typeof o.modelValue!="string")return!1;const e=o.fieldName?.toLowerCase()||"",a=o.modelValue.toString().trim();return e.includes("url")||e.includes("link")||/^https?:\/\//.test(a)}),Q=$(()=>typeof o.modelValue!="string"?!1:o.modelValue.length>50||(o.fieldName?.toLowerCase().includes("description")??!1)),X=$(()=>{if(!Array.isArray(o.modelValue)||o.modelValue.length===0)return!1;const e=o.modelValue[0];return typeof e=="string"?["interpolate","linear","exponential","get","to-number","step","match","case"].includes(e.toLowerCase()):!1}),Y=$(()=>{const e=o.fieldName?.toLowerCase()||"";return e==="default"||e==="geolevel"}),Z=$(()=>{const e=o.fieldName?.toLowerCase()||"";return e==="default"?[{title:"Left",value:"left"},{title:"Right",value:"right"},{title:"None (false)",value:!1}]:e==="geolevel"?[{title:"Area (choropleth)",value:"area"},{title:"Point (markers)",value:"point"}]:[]}),F=q("#000000");de(()=>o.modelValue,e=>{I.value&&typeof e=="string"&&(F.value=J(e))},{immediate:!0});function N(e){if(h.value&&typeof e=="string"&&e!==""){const a=Number(e);if(!isNaN(a)){_("update:modelValue",a);return}}_("update:modelValue",e)}function R(e,a){const V={...o.modelValue};V[e]=a,_("update:modelValue",V)}function s(e,a){const V=[...o.modelValue];V[e]=a,_("update:modelValue",V)}function t(){const e=[...o.modelValue];if(e.length>0){const a=e[0];typeof a=="object"&&a!==null?e.push({...a}):typeof a=="string"?e.push(""):typeof a=="number"?e.push(0):typeof a=="boolean"?e.push(!1):e.push(null)}else e.push({});_("update:modelValue",e)}function c(e){const a=[...o.modelValue];a.splice(e,1),_("update:modelValue",a)}function p(e){if(!e)return"#000000";if(e.startsWith("#"))return e;if(e.startsWith("rgb")){const a=e.match(/\d+/g);if(a&&a.length>=3){const V=parseInt(a[0]),O=parseInt(a[1]),E=parseInt(a[2]);return`#${[V,O,E].map(P=>P.toString(16).padStart(2,"0")).join("")}`}}return e.startsWith("hsla")||e.startsWith("hsl")?"#000000":e}function J(e){if(!e)return"#000000";if(e.startsWith("#"))return e;if(e.startsWith("rgb")){const a=e.match(/\d+/g);if(a&&a.length>=3){const V=parseInt(a[0]),O=parseInt(a[1]),E=parseInt(a[2]);return`#${[V,O,E].map(P=>P.toString(16).padStart(2,"0")).join("")}`}}return e.startsWith("hsla")||e.startsWith("hsl"),"#000000"}function U(e){F.value=typeof e=="string"?e:e?.hex||"#000000",N(F.value)}function k(e,a){if(o.fieldName==="indicators"||o.parentPath?.includes("indicators")){if(e?.title)return e.title;if(e?.short_name)return e.short_name}if(o.fieldName==="icons"||o.parentPath?.includes("icons")){if(e?.name)return e.name;if(e?.filename)return e.filename.split("/").pop()||`Icon ${a+1}`}return e?.title?e.title:e?.name?e.name:e?.label?e.label:`Item ${a+1}`}function j(e){try{const a=JSON.parse(e);Array.isArray(a)&&_("update:modelValue",a)}catch{}}return(e,a)=>{const V=r("v-expansion-panel-title"),O=r("JsonFormField",!0),E=r("v-expansion-panel-text"),P=r("v-expansion-panel"),K=r("v-expansion-panels"),H=r("v-textarea"),ee=r("v-chip"),z=r("v-btn"),G=r("v-card"),W=r("v-text-field"),u=r("v-checkbox"),b=r("v-icon"),ue=r("v-color-picker"),ie=r("v-menu"),re=r("v-select");return i(),d("div",fe,[typeof e.modelValue=="object"&&e.modelValue!==null&&!Array.isArray(e.modelValue)?(i(),d(M,{key:0},[e.isNested?(i(),S(K,{key:0,variant:"accordion",class:"mb-2 outer-expansion-panel"},{default:n(()=>[l(P,null,{default:n(()=>[l(V,null,{default:n(()=>[y("strong",null,D(m.value),1)]),_:1}),l(E,null,{default:n(()=>[(i(!0),d(M,null,B(e.modelValue,(A,f)=>(i(),d("div",{key:f,class:"mb-4"},[l(O,{modelValue:e.modelValue[f],"onUpdate:modelValue":[C=>e.modelValue[f]=C,C=>R(String(f),C)],"field-name":String(f),"parent-path":L.value,"is-nested":!0},null,8,["modelValue","onUpdate:modelValue","field-name","parent-path"])]))),128))]),_:1})]),_:1})]),_:1})):(i(),d("div",ve,[(i(!0),d(M,null,B(e.modelValue,(A,f)=>(i(),d("div",{key:f,class:"mb-4"},[l(O,{modelValue:e.modelValue[f],"onUpdate:modelValue":[C=>e.modelValue[f]=C,C=>R(String(f),C)],"field-name":String(f),"parent-path":L.value,"is-nested":!0},null,8,["modelValue","onUpdate:modelValue","field-name","parent-path"])]))),128))]))],64)):Array.isArray(e.modelValue)?(i(),d(M,{key:1},[X.value?(i(),d("div",_e,[l(H,{"model-value":JSON.stringify(e.modelValue,null,2),label:m.value,variant:"outlined",rows:"4",hint:"MapLibre expression array - edit as JSON","persistent-hint":"","onUpdate:modelValue":a[0]||(a[0]=A=>j(A))},null,8,["model-value","label"])])):e.isNested?(i(),S(K,{key:1,variant:"accordion",class:"mb-2"},{default:n(()=>[l(P,null,{default:n(()=>[l(V,null,{default:n(()=>[y("strong",null,D(m.value),1),l(ee,{size:"x-small",class:"ml-2"},{default:n(()=>[v(D(e.modelValue.length)+" items",1)]),_:1})]),_:1}),l(E,null,{default:n(()=>[(i(!0),d(M,null,B(e.modelValue,(A,f)=>(i(),d("div",{key:f,class:"mb-4"},[l(G,{variant:"outlined",class:"pa-3",style:{position:"relative"}},{default:n(()=>[l(O,{modelValue:e.modelValue[f],"onUpdate:modelValue":[C=>e.modelValue[f]=C,C=>s(f,C)],"field-name":k(A,f),"parent-path":L.value,"is-nested":!0},null,8,["modelValue","onUpdate:modelValue","field-name","parent-path"]),l(z,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",inline:"",style:{position:"absolute",bottom:"8px",right:"8px"},onClick:C=>c(f)},null,8,["onClick"])]),_:2},1024)]))),128)),l(z,{color:"primary",size:"small","prepend-icon":"mdi-plus",onClick:t,class:"mt-2"},{default:n(()=>[...a[2]||(a[2]=[v(" Add Item ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):(i(),d("div",Ve,[l(W,{"model-value":JSON.stringify(e.modelValue),label:m.value,variant:"outlined",readonly:"",hint:"Array - use JSON view to edit","persistent-hint":""},null,8,["model-value","label"])]))],64)):(i(),d(M,{key:2},[w.value?(i(),d("div",ge,[l(u,{"model-value":e.modelValue,label:m.value,hint:g.value,"persistent-hint":"","onUpdate:modelValue":N,"hide-details":"auto"},null,8,["model-value","label","hint"])])):I.value?(i(),d("div",ye,[l(W,{"model-value":e.modelValue,label:m.value,variant:"outlined",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},{append:n(()=>[l(ie,{location:"bottom","max-width":"300"},{activator:n(({props:A})=>[l(z,me(A,{style:{backgroundColor:p(e.modelValue)},icon:"",size:"small",variant:"flat"}),{default:n(()=>[l(b,null,{default:n(()=>[...a[3]||(a[3]=[v("mdi-palette",-1)])]),_:1})]),_:1},16,["style"])]),default:n(()=>[l(G,null,{default:n(()=>[l(ue,{modelValue:F.value,"onUpdate:modelValue":[a[1]||(a[1]=A=>F.value=A),U],mode:"hex","show-swatches":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model-value","label","hint"])])):h.value?(i(),d("div",he,[l(W,{"model-value":e.modelValue,label:m.value,type:"number",variant:"outlined",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},null,8,["model-value","label","hint"])])):T.value?(i(),d("div",be,[l(W,{"model-value":e.modelValue,label:m.value,type:"url",variant:"outlined",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},null,8,["model-value","label","hint"])])):Y.value?(i(),d("div",Ce,[l(re,{"model-value":e.modelValue,label:m.value,items:Z.value,variant:"outlined",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},null,8,["model-value","label","items","hint"])])):(i(),d("div",we,[Q.value?(i(),S(H,{key:0,"model-value":e.modelValue,label:m.value,variant:"outlined",rows:"3",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},null,8,["model-value","label","hint"])):(i(),S(W,{key:1,"model-value":e.modelValue,label:m.value,variant:"outlined",hint:g.value,"persistent-hint":"","onUpdate:modelValue":N},null,8,["model-value","label","hint"]))]))],64))])}}}),ne=se(Ne,[["__scopeId","data-v-6280696a"]]),Je={key:0},Ue={key:1},ke={class:"mt-4"},$e={key:1},Oe={key:2},qe={class:"mt-4"},Le=oe({__name:"ConfigEditor",setup(le){const x=q(""),o=q({}),_=q(null),L=q("form"),m=q([]),g=q({}),w=q({}),h=q({}),I=q(null);pe(async()=>{await T()});async function T(){try{const s=ce("sitePath"),t=await te.get(`${s}/config/main.json`);o.value=t.data,x.value=JSON.stringify(o.value,null,2);const c=o.value.categories||[];m.value=c.filter(p=>p.config);for(const p of m.value)try{const J=await te.get(`${s}${p.config}`);w.value[p.query_str]=J.data,g.value[p.query_str]=JSON.stringify(J.data,null,2),h.value[p.query_str]=null}catch(J){w.value[p.query_str]={},g.value[p.query_str]="{}",h.value[p.query_str]=`Failed to load: ${J.message}`}m.value.length>0&&(I.value=m.value[0].query_str)}catch(s){_.value=`Failed to load main config: ${s.message}`}}function Q(s){o.value=s,x.value=JSON.stringify(s,null,2),_.value=null}function X(s,t){w.value[s]=t,g.value[s]=JSON.stringify(t,null,2),h.value[s]=null}function Y(s){try{o.value=JSON.parse(s),_.value=null}catch{}}function Z(s,t){try{w.value[s]=JSON.parse(t),h.value[s]=null}catch{}}function F(s){try{s==="main"?(JSON.parse(x.value),_.value=null,alert("✓ Valid JSON!")):(JSON.parse(g.value[s]),h.value[s]=null,alert("✓ Valid JSON!"))}catch(t){const c=`Invalid JSON: ${t.message}`;s==="main"?_.value=c:h.value[s]=c,alert(`✗ ${c}`)}}function N(s){try{let t,c;if(s==="main"){const k=JSON.parse(x.value);t=JSON.stringify(k,null,2),c="main.json",_.value=null,o.value=k}else{const k=JSON.parse(g.value[s]),j=m.value.find(e=>e.query_str===s);t=JSON.stringify(k,null,2),c=R(j?.config||`${s}.json`),h.value[s]=null,w.value[s]=k}const p=new Blob([t],{type:"application/json"}),J=URL.createObjectURL(p),U=document.createElement("a");U.href=J,U.download=c,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(J),alert(`✓ Downloaded ${c}`)}catch(t){const c=`Invalid JSON: ${t.message}`;s==="main"?_.value=c:h.value[s]=c,alert(`✗ ${c}`)}}function R(s){if(!s)return"config.json";const t=s.split("/");return t[t.length-1]||"config.json"}return(s,t)=>{const c=r("v-spacer"),p=r("v-btn"),J=r("v-btn-toggle"),U=r("v-card-title"),k=r("v-alert"),j=r("v-card-text"),e=r("v-card"),a=r("v-col"),V=r("v-row"),O=r("v-textarea"),E=r("v-chip"),P=r("v-tab"),K=r("v-tabs"),H=r("v-text-field"),ee=r("v-window-item"),z=r("v-window"),G=r("v-container"),W=r("v-main");return i(),S(W,null,{default:n(()=>[l(G,{fluid:""},{default:n(()=>[l(V,null,{default:n(()=>[l(a,{cols:"12"},{default:n(()=>[l(e,null,{default:n(()=>[l(U,null,{default:n(()=>[t[10]||(t[10]=y("span",{class:"text-h5"},"Configuration Editor",-1)),l(c),l(J,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=u=>L.value=u),mandatory:"",density:"compact",class:"mr-4"},{default:n(()=>[l(p,{value:"form",size:"small"},{default:n(()=>[...t[7]||(t[7]=[v("Form View",-1)])]),_:1}),l(p,{value:"json",size:"small"},{default:n(()=>[...t[8]||(t[8]=[v("JSON View",-1)])]),_:1})]),_:1},8,["modelValue"]),l(p,{color:"primary",onClick:T,"prepend-icon":"mdi-refresh"},{default:n(()=>[...t[9]||(t[9]=[v(" Reload Configs ",-1)])]),_:1})]),_:1}),l(j,null,{default:n(()=>[l(k,{type:"info",variant:"tonal",class:"mb-4"},{default:n(()=>[...t[11]||(t[11]=[y("strong",null,"Note:",-1),v(" This editor allows you to view and edit configuration files. Since this is a client-side application, you can download edited files and manually replace them in the public/config folder. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(V,null,{default:n(()=>[l(a,{cols:"12"},{default:n(()=>[l(e,null,{default:n(()=>[l(U,null,{default:n(()=>[...t[12]||(t[12]=[y("span",{class:"text-h6"},"Main Configuration (main.json)",-1)])]),_:1}),l(j,null,{default:n(()=>[L.value==="form"?(i(),d("div",Je,[l(ne,{modelValue:o.value,"onUpdate:modelValue":[t[1]||(t[1]=u=>o.value=u),Q],path:"main"},null,8,["modelValue"])])):(i(),d("div",Ue,[l(O,{modelValue:x.value,"onUpdate:modelValue":[t[2]||(t[2]=u=>x.value=u),Y],label:"main.json",rows:"15",variant:"outlined",error:_.value!==null,"error-messages":_.value},null,8,["modelValue","error","error-messages"])])),y("div",ke,[l(p,{color:"success",onClick:t[3]||(t[3]=u=>N("main")),"prepend-icon":"mdi-download",class:"mr-2"},{default:n(()=>[...t[13]||(t[13]=[v(" Download main.json ",-1)])]),_:1}),l(p,{color:"primary",onClick:t[4]||(t[4]=u=>F("main")),"prepend-icon":"mdi-check"},{default:n(()=>[...t[14]||(t[14]=[v(" Validate JSON ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),l(V,null,{default:n(()=>[l(a,{cols:"12"},{default:n(()=>[l(e,null,{default:n(()=>[l(U,null,{default:n(()=>[t[15]||(t[15]=y("span",{class:"text-h6"},"Category Configurations",-1)),l(c),l(E,{size:"small",color:"info",variant:"tonal"},{default:n(()=>[v(D(m.value.length)+" category"+D(m.value.length!==1?"ies":"y"),1)]),_:1})]),_:1}),l(j,null,{default:n(()=>[l(k,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:n(()=>[...t[16]||(t[16]=[y("strong",null,"Category Configs:",-1),v(" Each category config file contains an ",-1),y("code",null,"indicators",-1),v(" array. Each indicator can be for ",-1),y("code",null,"area",-1),v(" (choropleth maps) or ",-1),y("code",null,"point",-1),v(" (icon markers) geolevels. ",-1)])]),_:1}),l(K,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=u=>I.value=u),color:"primary"},{default:n(()=>[(i(!0),d(M,null,B(m.value,u=>(i(),S(P,{key:u.query_str,value:u.query_str},{default:n(()=>[v(D(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(z,{modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=u=>I.value=u)},{default:n(()=>[(i(!0),d(M,null,B(m.value,u=>(i(),S(ee,{key:u.query_str,value:u.query_str},{default:n(()=>[l(e,{variant:"flat",class:"mt-4"},{default:n(()=>[l(j,null,{default:n(()=>[L.value==="form"&&w.value[u.query_str]?.indicators?(i(),S(k,{key:0,type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:n(()=>[y("strong",null,D(w.value[u.query_str].indicators.length)+" indicator(s)",1),t[17]||(t[17]=v(" in this category. Expand the indicators array below to edit individual indicators. ",-1))]),_:2},1024)):ae("",!0),L.value==="form"?(i(),d("div",$e,[l(ne,{modelValue:w.value[u.query_str],"onUpdate:modelValue":[b=>w.value[u.query_str]=b,b=>X(u.query_str,b)],path:u.query_str},null,8,["modelValue","onUpdate:modelValue","path"])])):(i(),d("div",Oe,[l(H,{modelValue:u.config,"onUpdate:modelValue":b=>u.config=b,label:"Config File Path",variant:"outlined",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"]),l(O,{modelValue:g.value[u.query_str],"onUpdate:modelValue":[b=>g.value[u.query_str]=b,b=>Z(u.query_str,b)],label:`${u.title} Configuration`,rows:"20",variant:"outlined",error:h.value[u.query_str]!==null,"error-messages":h.value[u.query_str]},null,8,["modelValue","onUpdate:modelValue","label","error","error-messages"])])),y("div",qe,[l(p,{color:"success",onClick:b=>N(u.query_str),"prepend-icon":"mdi-download",class:"mr-2"},{default:n(()=>[v(" Download "+D(R(u.config)),1)]),_:2},1032,["onClick"]),l(p,{color:"primary",onClick:b=>F(u.query_str),"prepend-icon":"mdi-check"},{default:n(()=>[...t[18]||(t[18]=[v(" Validate JSON ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),m.value.length===0?(i(),S(j,{key:0,class:"text-center py-8"},{default:n(()=>[...t[19]||(t[19]=[y("p",{class:"text-body-1"},"No categories with config files found.",-1),y("p",{class:"text-body-2 text-medium-emphasis"},' Add a "config" property to categories in main.json to enable editing. ',-1)])]),_:1})):ae("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ae=se(Le,[["__scopeId","data-v-409335c7"]]);export{Ae as default};
