const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/symbolLayerUtils-BNlmian-.js","assets/index-DtWsY0yY.js","assets/index-DydP-41E.css","assets/MapPage-BqDFg4OT.js","assets/themeLevelStore-Cj2dUhSE.js","assets/MapPage-kSfHLSm1.css","assets/LRUCache-Bk6V7uqy.js"])))=>i.map(i=>d[i]);
import{_ as L}from"./index-DtWsY0yY.js";import{bS as s,dx as y,f6 as p,f7 as P,f8 as $}from"./MapPage-BqDFg4OT.js";import{a as x}from"./asyncUtils-BoG2C-0J.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-BO2gVlab.js";import{y as b,C as I,m as k,h as S,M as z}from"./utils-CNckjA7H.js";import{e as E}from"./LRUCache-Bk6V7uqy.js";function _(o){const r=[];return C(b(o),r),r.length?new s(z(r[0])):null}function C(o,r){if(!o)return;let n;n=o.type==="CIMTextSymbol"?o.symbol:o;const l=o.type==="CIMPolygonSymbol";if(n?.symbolLayers){for(const a of n.symbolLayers)if(!(a.colorLocked||l&&(I(a)||k(a)&&a.markerPlacement&&S(a.markerPlacement))))switch(a.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":a.tintColor&&m(r,a.tintColor);break;case"CIMVectorMarker":a.markerGraphics?.forEach(t=>{C(t.symbol,r)});break;case"CIMSolidStroke":case"CIMSolidFill":m(r,a.color);break;case"CIMGradientFill":v(r,a);break;case"CIMHatchFill":C(a.lineSymbol,r)}}}function m(o,r){for(const n of o)if(n.join(".")===r.join("."))return;o.push(r)}function v(o,r){switch(r.colorRamp?.type){case"CIMMultipartColorRamp":r.colorRamp.colorRamps?.forEach(l=>{l.type==="CIMLinearContinuousColorRamp"&&M(o,l)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":M(o,r.colorRamp)}}function M(o,r){r&&(r.fromColor&&m(o,r.fromColor),r.toColor&&m(o,r.toColor))}function oo(o,r,n){r instanceof s||(r=new s(r));const l=b(o);l&&h(l,r)}function h(o,r,n){if(!o)return;let l;l=o.type==="CIMTextSymbol"?o.symbol:o;const a=l?.type==="CIMPolygonSymbol";if(l?.symbolLayers)for(const t of l.symbolLayers){if(t.colorLocked||a&&(I(t)||k(t)&&t.markerPlacement&&S(t.markerPlacement)))continue;const e=r.toArray();switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor=e;break;case"CIMVectorMarker":t.markerGraphics?.forEach(i=>{h(i.symbol,r)});break;case"CIMSolidStroke":case"CIMSolidFill":t.color=e;break;case"CIMGradientFill":F(t,r);break;case"CIMHatchFill":h(t.lineSymbol,r)}}}function F(o,r){switch(o.colorRamp?.type){case"CIMMultipartColorRamp":o.colorRamp.colorRamps?.forEach(l=>{l.type==="CIMLinearContinuousColorRamp"&&w(l,r)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":w(o.colorRamp,r)}}function w(o,r){if(o&&(o.fromColor&&(o.fromColor=r.toArray()),o.toColor)){const n=r.clone();n.a=0,o.toColor=n.toArray()}}function j(o,r,n=!1){const l=b(o);if(n&&(r=360-r),l?.type!=="CIMTextSymbol"){if(l?.type==="CIMPointSymbol"&&l.symbolLayers){const a=r-(l.angle||0);for(const t of l.symbolLayers)if(k(t)){let e=t.rotation||0;t.rotateClockwise?e-=a:e+=a,t.rotation=e}l.angle=r}}else l.angle=r}new E(1e3);new s([128,128,128]);function ro(o,r){if(!o)return null;let n=null;return y(o)?n=A(o):p(o)&&(n=o.type==="cim"?_(o):o.color?new s(o.color):null),n?f(n,r):null}function A(o){const r=o.symbolLayers;if(!r)return null;let n=null;return r.forEach(l=>{l.type==="object"&&l.resource?.href||(n=l.type==="water"?l.color:l.material?l.material.color:null)}),n?new s(n):null}function f(o,r){if(r==null||o==null)return o;const n=o.toRgba();return n[3]=n[3]*r,new s(n)}function G(o,r,n){const l=o.symbolLayers;if(!l)return;const a=(t,e=!1)=>f(r??t??null,n?.add);l.forEach(t=>{if(t.type==="water")return void(t.color=f(t.color,n?.add));const e=t.material!=null?t.material.color:null,i=a(e,t.type==="icon"&&t.resource?.href!=null);t.material==null?t.material=new P({color:i}):t.material.color=i,"outline"in t&&t.outline?.color&&n?.add!=null,"marker"in t&&t.marker!=null&&(t.marker.color=a(t.marker.color))})}function T(o,r,n){r=r??o.color,r&&(o.color=f(r,n?.add)),"outline"in o&&o.outline?.color&&(o.outline.color=f(o.outline.color,n?.add))}function no(o,r,n){o&&(r||n!=null)&&(r&&(r=new s(r)),y(o)?G(o,r,n):p(o)&&T(o,r,n))}async function O(o,r){const n=o.symbolLayers;n&&await x(n,async l=>V(l,r))}async function V(o,r){switch(o.type){case"extrude":H(o,r);break;case"icon":case"line":case"text":D(o,r);break;case"path":N(o,r);break;case"object":await J(o,r)}}function D(o,r){const n=g(r);n!=null&&(o.size=n)}function g(o){for(const r of o)if(typeof r=="number")return r;return null}function H(o,r){const n=r[2];typeof n=="number"&&(o.size=n)}async function J(o,r){const{resourceSize:n,symbolSize:l}=await U(o),a=R(r,n,l);a!=null&&(o.width=u(r[0],l[0],n[0],a),o.depth=u(r[1],l[1],n[1],a),o.height=u(r[2],l[2],n[2],a))}function N(o,r){const n=R(r,$,[o.width,void 0,o.height]);n!=null&&(o.width=u(r[0],o.width,1,n),o.height=u(r[2],o.height,1,n))}function R(o,r,n){for(let l=0;l<3;l++){const a=o[l];switch(a){case"symbol-value":{const t=n[l];return t!=null?t/r[l]:1}case"proportional":break;default:if(a&&r[l])return a/r[l]}}return null}async function U(o){const{computeObjectLayerResourceSize:r}=await L(()=>import("./symbolLayerUtils-BNlmian-.js"),__vite__mapDeps([0,1,2,3,4,5,6])),n=await r(o,10),{width:l,height:a,depth:t}=o,e=[l,t,a];let i=1;for(let c=0;c<3;c++){const d=e[c];if(d!=null){i=d/n[c];break}}for(let c=0;c<3;c++)e[c]==null&&(e[c]=n[c]*i);return{resourceSize:n,symbolSize:e}}function u(o,r,n,l){switch(o){case"proportional":return n*l;case"symbol-value":return r??n;default:return o}}function q(o,r){const n=g(r);if(n!=null)switch(o.type){case"simple-marker":o.size=n;break;case"picture-marker":{const l=o.width/o.height;l>1?(o.width=n,o.height=n*l):(o.width=n*l,o.height=n);break}case"simple-line":o.width=n;break;case"text":o.font.size=n}}async function lo(o,r){if(o&&r)return y(o)?O(o,r):void(p(o)&&q(o,r))}function to(o,r,n){if(o&&r!=null){if(y(o)){const l=o.symbolLayers;l&&l.forEach(a=>{if(a.type==="object")switch(n){case"tilt":a.tilt=(a.tilt??0)+r;break;case"roll":a.roll=(a.roll??0)+r;break;default:a.heading=(a.heading??0)+r}a.type==="icon"&&(a.angle+=r)})}else if(p(o))switch(o.type){case"simple-marker":case"picture-marker":case"text":o.angle+=r;break;case"cim":j(o,r,!0)}}}export{no as L,lo as M,to as N,ro as b,oo as k};
