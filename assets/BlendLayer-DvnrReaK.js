import{gk as Ze,aN as tr,s as b,gl as er,gm as rr,gn as nr,go as sr,d_ as ar,_ as Z,z as At,A as or}from"./MapPage-CPF73lPx.js";import{a as tt}from"./OperationalLayer--tsDO1h0.js";import{e as kt}from"./mat4f32-Djp3mnm5.js";import{r as J,s as I}from"./mat4-BseGW36B.js";const ur=(r,n)=>{const t=J(r,n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1);return I(t,t)},ir=(r,n)=>{const t=J(r,n,0,0,.5-.5*n,0,n,0,.5-.5*n,0,0,n,.5-.5*n,0,0,0,1);return I(t,t)},cr=(r,n)=>{const t=1-n,u=J(r,.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,1);return I(u,u)},lr=(r,n)=>{const t=Math.sin(n*Math.PI/180),u=Math.cos(n*Math.PI/180),f=J(r,.213+.787*u-.213*t,.715-.715*u-.715*t,.072-.072*u+.928*t,0,.213-.213*u+.143*t,.715+.285*u+.14*t,.072-.072*u-.283*t,0,.213-.213*u-.787*t,.715-.715*u+.715*t,.072+.928*u+.072*t,0,0,0,0,1);return I(f,f)},fr=(r,n)=>{const t=1-2*n,u=J(r,t,0,0,n,0,t,0,n,0,0,t,n,0,0,0,1);return I(u,u)},hr=(r,n)=>{const t=J(r,.213+.787*n,.715-.715*n,.072-.072*n,0,.213-.213*n,.715+.285*n,.072-.072*n,0,.213-.213*n,.715-.715*n,.072+.928*n,0,0,0,0,1);return I(t,t)},pr=(r,n)=>{const t=1-n,u=J(r,.393+.607*t,.769-.769*t,.189-.189*t,0,.349-.349*t,.686+.314*t,.168-.168*t,0,.272-.272*t,.534-.534*t,.131+.869*t,0,0,0,0,1);return I(u,u)};let Rt=class St{constructor(n,t,u){this.strength=n,this.radius=t,this.threshold=u,this.type="bloom"}interpolate(n,t,u){this.strength=$(n.strength,t.strength,u),this.radius=$(n.radius,t.radius,u),this.threshold=$(n.threshold,t.threshold,u)}clone(){return new St(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:D(this.radius),strength:this.strength,threshold:this.threshold}}},Nt=class Ot{constructor(n){this.radius=n,this.type="blur"}interpolate(n,t,u){this.radius=Math.round($(n.radius,t.radius,u))}clone(){return new Ot(this.radius)}toJSON(){return{type:"blur",radius:D(this.radius)}}},et=class Pt{constructor(n,t){this.type=n,this.amount=t,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(n,t,u){this.amount=$(n.amount,t.amount,u),this._updateMatrix()}clone(){return new Pt(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const n=this._colorMatrix||kt();switch(this.type){case"brightness":this._colorMatrix=ur(n,this.amount);break;case"contrast":this._colorMatrix=ir(n,this.amount);break;case"grayscale":this._colorMatrix=cr(n,this.amount);break;case"invert":this._colorMatrix=fr(n,this.amount);break;case"saturate":this._colorMatrix=hr(n,this.amount);break;case"sepia":this._colorMatrix=pr(n,this.amount)}}},jt=class Jt{constructor(n,t,u,f){this.offsetX=n,this.offsetY=t,this.blurRadius=u,this.color=f,this.type="drop-shadow"}interpolate(n,t,u){this.offsetX=$(n.offsetX,t.offsetX,u),this.offsetY=$(n.offsetY,t.offsetY,u),this.blurRadius=$(n.blurRadius,t.blurRadius,u),this.color[0]=Math.round($(n.color[0],t.color[0],u)),this.color[1]=Math.round($(n.color[1],t.color[1],u)),this.color[2]=Math.round($(n.color[2],t.color[2],u)),this.color[3]=$(n.color[3],t.color[3],u)}clone(){return new Jt(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const n=[...this.color];return n[3]*=255,{type:"drop-shadow",xoffset:D(this.offsetX),yoffset:D(this.offsetY),blurRadius:D(this.blurRadius),color:n}}},It=class qt{constructor(n){this.angle=n,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(n,t,u){this.angle=$(n.angle,t.angle,u),this._updateMatrix()}clone(){return new qt(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const n=this._colorMatrix||kt();this._colorMatrix=lr(n,this.angle)}},zt=class Tt{constructor(n){this.amount=n,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(n,t,u){this.amount=$(n.amount,t.amount,u)}clone(){return new Tt(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function $(r,n,t){return r+(n-r)*t}function D(r){return Math.round(1e3*tr(r))/1e3}function gr(r){switch(r.type){case"grayscale":case"sepia":case"invert":return new et(r.type,0);case"saturate":case"brightness":case"contrast":return new et(r.type,1);case"opacity":return new zt(1);case"hue-rotate":return new It(0);case"blur":return new Nt(0);case"drop-shadow":return new jt(0,0,0,[...Ze("transparent")]);case"bloom":return new Rt(0,0,1)}}function mr(r,n){const t=r.length>n.length?r:n;return(r.length>n.length?n:r).every((u,f)=>u.type===t[f].type)}function dr(r,n){const t=r.length>n.length?r:n,u=r.length>n.length?n:r;for(let f=u.length;f<t.length;f++)u.push(gr(t[f]))}function yr(r){const n=r[0];return!!n&&"type"in n}class Ct extends SyntaxError{constructor(n,t,u,f){super(n),this.expected=t,this.found=u,this.location=f,this.name="SyntaxError"}format(n){let t="Error: "+this.message;if(this.location){let u=null;const f=n.find(k=>k.source===this.location.source);f&&(u=f.text.split(/\r\n|\n|\r/g));const M=this.location.start,_=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(M):M,S=this.location.source+":"+_.line+":"+_.column;if(u){const k=this.location.end,q="".padEnd(_.line.toString().length," "),z=u[M.line-1],T=(M.line===k.line?k.column:z.length+1)-M.column||1;t+=`
 --> `+S+`
`+q+` |
`+_.line+" | "+z+`
`+q+" | "+"".padEnd(M.column-1," ")+"".padEnd(T,"^")}else t+=`
 at `+S}return t}static buildMessage(n,t){function u(g){return g.codePointAt(0).toString(16).toUpperCase()}const f=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function M(g){return f?g.replace(f,h=>"\\u{"+u(h)+"}"):g}function _(g){return M(g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,h=>"\\x0"+u(h)).replace(/[\x10-\x1F\x7F-\x9F]/g,h=>"\\x"+u(h)))}function S(g){return M(g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,h=>"\\x0"+u(h)).replace(/[\x10-\x1F\x7F-\x9F]/g,h=>"\\x"+u(h)))}const k={literal:g=>'"'+_(g.text)+'"',class(g){const h=g.parts.map(C=>Array.isArray(C)?S(C[0])+"-"+S(C[1]):S(C));return"["+(g.inverted?"^":"")+h.join("")+"]"+(g.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:g=>g.description};function q(g){return k[g.type](g)}function z(g){const h=g.map(q);if(h.sort(),h.length>0){let C=1;for(let N=1;N<h.length;N++)h[N-1]!==h[N]&&(h[C]=h[N],C++);h.length=C}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function T(g){return g?'"'+_(g)+'"':"end of input"}return"Expected "+z(n)+" but "+T(t)+" found."}}function wr(r,n){const t={},u=(n=n!==void 0?n:{}).grammarSource,f={start:vt};let M=vt;const _="none",S=")",k=",",q="(",z="%",T="px",g="cm",h="mm",C="in",N="pt",at="pc",ot="deg",ut="rad",it="grad",ct="turn",Lt="#",Bt=".",Dt="e",lt=/^[ \t\n\r]/,ft=/^[a-z\-]/,ht=/^[0-9a-fA-F]/,pt=/^[+\-]/,O=/^[0-9]/,Ut=j("none"),Gt=w("none",!1),Ht=w(")",!1),gt=w(",",!1),mt=B([" ","	",`
`,"\r"],!1,!1,!1),Kt=j("function"),Qt=w("(",!1),Vt=j("identifier"),dt=B([["a","z"],"-"],!1,!1,!1),Wt=j("percentage"),Zt=w("%",!1),te=j("length"),ee=w("px",!1),re=w("cm",!1),ne=w("mm",!1),se=w("in",!1),ae=w("pt",!1),oe=w("pc",!1),ue=j("angle"),ie=w("deg",!1),ce=w("rad",!1),le=w("grad",!1),fe=w("turn",!1),he=j("number"),pe=j("color"),ge=w("#",!1),yt=B([["0","9"],["a","f"],["A","F"]],!1,!1,!1),wt=B(["+","-"],!1,!1,!1),P=B([["0","9"]],!1,!1,!1),me=w(".",!1),de=w("e",!1);function ye(){return[]}function we(e,s){return{type:"function",name:e,parameters:s||[]}}function xe(e,s){return s.length>0?We(e,s,3):[e]}function be(e){return{type:"quantity",value:e.value,unit:e.unit}}function ve(e){return{type:"color",colorType:e.type,value:e.value}}function Br(e){return e}function $e(){return H()}function Me(e){return{value:e,unit:"%"}}function Ae(e){return{value:e,unit:"px"}}function Ce(e){return{value:e,unit:"cm"}}function Fe(e){return{value:e,unit:"mm"}}function Ee(e){return{value:e,unit:"in"}}function _e(e){return{value:e,unit:"pt"}}function ke(e){return{value:e,unit:"pc"}}function Re(e){return{value:e,unit:"deg"}}function Se(e){return{value:e,unit:"rad"}}function Ne(e){return{value:e,unit:"grad"}}function Oe(e){return{value:e,unit:"turn"}}function Pe(e){return{value:e,unit:null}}function je(){return{type:"hex",value:H()}}function Je(e){return{type:"function",value:e}}function Ie(){return{type:"named",value:H()}}function qe(){return parseFloat(H())}let a=0|n.peg$currPos,m=a;const X=[{line:1,column:1}];let L,F=a,G=n.peg$maxFailExpected||[],i=0|n.peg$silentFails;if(n.startRule){if(!(n.startRule in f))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');M=f[n.startRule]}function H(){return r.substring(m,a)}function ze(e=a){const s=r.codePointAt(e);return s===void 0?"":String.fromCodePoint(s)}function w(e,s){return{type:"literal",text:e,ignoreCase:s}}function B(e,s,o,c){return{type:"class",parts:e,inverted:s,ignoreCase:o,unicode:c}}function Te(){return{type:"end"}}function j(e){return{type:"other",description:e}}function xt(e){let s,o=X[e];if(o)return o;if(e>=X.length)s=X.length-1;else for(s=e;!X[--s];);for(o=X[s],o={line:o.line,column:o.column};s<e;)r.charCodeAt(s)===10?(o.line++,o.column=1):o.column++,s++;return X[e]=o,o}function bt(e,s,o){const c=xt(e),p=xt(s);return{source:u,start:{offset:e,line:c.line,column:c.column},end:{offset:s,line:p.line,column:p.column}}}function l(e){a<F||(a>F&&(F=a,G=[]),G.push(e))}function Xe(e,s,o){return new Ct(Ct.buildMessage(e,s),e,s,o)}function vt(){let e;return e=Ye(),e===t&&(e=Le()),e}function Ye(){let e,s;return i++,e=a,x(),r.substr(a,4)===_?(s=_,a+=4):(s=t,i===0&&l(Gt)),s!==t?(x(),m=e,e=ye()):(a=e,e=t),i--,e===t&&i===0&&l(Ut),e}function Le(){let e,s;if(e=[],s=Q(),s!==t)for(;s!==t;)e.push(s),s=Q();else e=t;return e}function Q(){let e,s,o,c;return e=a,x(),s=De(),s!==t?(x(),o=Be(),o===t&&(o=null),x(),r.charCodeAt(a)===41?(c=S,a++):(c=t,i===0&&l(Ht)),c!==t?(x(),m=e,e=we(s,o)):(a=e,e=t)):(a=e,e=t),e}function Be(){let e,s,o,c,p,d,y,v;if(e=a,s=V(),s!==t){for(o=[],c=a,p=x(),r.charCodeAt(a)===44?(d=k,a++):(d=t,i===0&&l(gt)),d===t&&(d=null),y=x(),v=V(),v!==t?(p=[p,d,y,v],c=p):(a=c,c=t);c!==t;)o.push(c),c=a,p=x(),r.charCodeAt(a)===44?(d=k,a++):(d=t,i===0&&l(gt)),d===t&&(d=null),y=x(),v=V(),v!==t?(p=[p,d,y,v],c=p):(a=c,c=t);m=e,e=xe(s,o)}else a=e,e=t;return e}function V(){let e,s;return e=a,s=Ue(),s===t&&(s=Ge(),s===t&&(s=He(),s===t&&(s=Ke()))),s!==t&&(m=e,s=be(s)),e=s,e===t&&(e=a,s=Qe(),s!==t&&(m=e,s=ve(s)),e=s),e}function x(){let e,s;for(i++,e=[],s=r.charAt(a),lt.test(s)?a++:(s=t,i===0&&l(mt));s!==t;)e.push(s),s=r.charAt(a),lt.test(s)?a++:(s=t,i===0&&l(mt));return i--,e}function De(){let e,s,o;return i++,e=a,s=$t(),s!==t?(r.charCodeAt(a)===40?(o=q,a++):(o=t,i===0&&l(Qt)),o!==t?(m=e,e=s):(a=e,e=t)):(a=e,e=t),i--,e===t&&(s=t,i===0&&l(Kt)),e}function $t(){let e,s,o;if(i++,e=a,s=[],o=r.charAt(a),ft.test(o)?a++:(o=t,i===0&&l(dt)),o!==t)for(;o!==t;)s.push(o),o=r.charAt(a),ft.test(o)?a++:(o=t,i===0&&l(dt));else s=t;return s!==t&&(m=e,s=$e()),e=s,i--,e===t&&(s=t,i===0&&l(Vt)),e}function Ue(){let e,s,o;return i++,e=a,x(),s=A(),s!==t?(r.charCodeAt(a)===37?(o=z,a++):(o=t,i===0&&l(Zt)),o!==t?(m=e,e=Me(s)):(a=e,e=t)):(a=e,e=t),i--,e===t&&i===0&&l(Wt),e}function Ge(){let e,s,o;return i++,e=a,x(),s=A(),s!==t?(r.substr(a,2)===T?(o=T,a+=2):(o=t,i===0&&l(ee)),o!==t?(m=e,e=Ae(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,x(),s=A(),s!==t?(r.substr(a,2)===g?(o=g,a+=2):(o=t,i===0&&l(re)),o!==t?(m=e,e=Ce(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,x(),s=A(),s!==t?(r.substr(a,2)===h?(o=h,a+=2):(o=t,i===0&&l(ne)),o!==t?(m=e,e=Fe(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,x(),s=A(),s!==t?(r.substr(a,2)===C?(o=C,a+=2):(o=t,i===0&&l(se)),o!==t?(m=e,e=Ee(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,x(),s=A(),s!==t?(r.substr(a,2)===N?(o=N,a+=2):(o=t,i===0&&l(ae)),o!==t?(m=e,e=_e(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,x(),s=A(),s!==t?(r.substr(a,2)===at?(o=at,a+=2):(o=t,i===0&&l(oe)),o!==t?(m=e,e=ke(s)):(a=e,e=t)):(a=e,e=t)))))),i--,e===t&&i===0&&l(te),e}function He(){let e,s,o;return i++,e=a,s=A(),s!==t?(r.substr(a,3)===ot?(o=ot,a+=3):(o=t,i===0&&l(ie)),o!==t?(m=e,e=Re(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,s=A(),s!==t?(r.substr(a,3)===ut?(o=ut,a+=3):(o=t,i===0&&l(ce)),o!==t?(m=e,e=Se(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,s=A(),s!==t?(r.substr(a,4)===it?(o=it,a+=4):(o=t,i===0&&l(le)),o!==t?(m=e,e=Ne(s)):(a=e,e=t)):(a=e,e=t),e===t&&(e=a,s=A(),s!==t?(r.substr(a,4)===ct?(o=ct,a+=4):(o=t,i===0&&l(fe)),o!==t?(m=e,e=Oe(s)):(a=e,e=t)):(a=e,e=t)))),i--,e===t&&(s=t,i===0&&l(ue)),e}function Ke(){let e,s;return i++,e=a,x(),s=A(),s!==t?(m=e,e=Pe(s)):(a=e,e=t),i--,e===t&&i===0&&l(he),e}function Qe(){let e,s,o,c;if(i++,e=a,r.charCodeAt(a)===35?(s=Lt,a++):(s=t,i===0&&l(ge)),s!==t){if(o=[],c=r.charAt(a),ht.test(c)?a++:(c=t,i===0&&l(yt)),c!==t)for(;c!==t;)o.push(c),c=r.charAt(a),ht.test(c)?a++:(c=t,i===0&&l(yt));else o=t;o!==t?(m=e,e=je()):(a=e,e=t)}else a=e,e=t;return e===t&&(e=a,s=Q(),s!==t&&(m=e,s=Je(s)),e=s,e===t&&(e=a,s=$t(),s!==t&&(m=e,s=Ie()),e=s)),i--,e===t&&(s=t,i===0&&l(pe)),e}function A(){let e,s,o,c,p,d,y,v;for(e=a,s=r.charAt(a),pt.test(s)?a++:(s=t,i===0&&l(wt)),s===t&&(s=null),o=a,c=[],p=r.charAt(a),O.test(p)?a++:(p=t,i===0&&l(P));p!==t;)c.push(p),p=r.charAt(a),O.test(p)?a++:(p=t,i===0&&l(P));if(r.charCodeAt(a)===46?(p=Bt,a++):(p=t,i===0&&l(me)),p!==t){if(d=[],y=r.charAt(a),O.test(y)?a++:(y=t,i===0&&l(P)),y!==t)for(;y!==t;)d.push(y),y=r.charAt(a),O.test(y)?a++:(y=t,i===0&&l(P));else d=t;d!==t?(c=[c,p,d],o=c):(a=o,o=t)}else a=o,o=t;if(o===t)if(o=[],c=r.charAt(a),O.test(c)?a++:(c=t,i===0&&l(P)),c!==t)for(;c!==t;)o.push(c),c=r.charAt(a),O.test(c)?a++:(c=t,i===0&&l(P));else o=t;if(o!==t){if(c=a,r.charCodeAt(a)===101?(p=Dt,a++):(p=t,i===0&&l(de)),p!==t){if(d=r.charAt(a),pt.test(d)?a++:(d=t,i===0&&l(wt)),d===t&&(d=null),y=[],v=r.charAt(a),O.test(v)?a++:(v=t,i===0&&l(P)),v!==t)for(;v!==t;)y.push(v),v=r.charAt(a),O.test(v)?a++:(v=t,i===0&&l(P));else y=t;y!==t?(p=[p,d,y],c=p):(a=c,c=t)}else a=c,c=t;c===t&&(c=null),m=e,e=qe()}else a=e,e=t;return e}function Ve(e,s){return e.map(function(o){return o[s]})}function We(e,s,o){return[e].concat(Ve(s,o))}L=M();const W=L!==t&&a===r.length;function Mt(){throw L!==t&&a<r.length&&l(Te()),Xe(G,F<r.length?ze(F):null,F<r.length?bt(F,F+1):bt(F,F))}return n.peg$library?{peg$result:L,peg$currPos:a,peg$FAILED:t,peg$maxFailExpected:G,peg$maxFailPos:F,peg$success:W,peg$throw:W?void 0:Mt}:W?L:void Mt()}function Xt(r){if(!r||r.length===0)return null;if(typeof r=="string"){const t=Ft(r);return t&&t.length!==0?t:null}const n=r.map(t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new b("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:Ft(t.value)}});n.sort((t,u)=>u.effects.length-t.effects.length);for(let t=0;t<n.length-1;t++){if(!mr(n[t].effects,n[t+1].effects))throw new b("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:n[t].effects,b:n[t+1].effects});dr(n[t].effects,n[t+1].effects)}return n.sort((t,u)=>u.scale-t.scale),n}function Ft(r){let n;if(!r)return[];try{n=wr(r)}catch(t){throw new b("effect:invalid-syntax","Invalid effect syntax",{value:r,error:t})}return n.map(t=>xr(t))}function xr(r){try{switch(r.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return br(r);case"opacity":return vr(r);case"hue-rotate":return $r(r);case"blur":return Mr(r);case"drop-shadow":return Ar(r);case"bloom":return Cr(r)}}catch(n){throw n.details.filter=r,n}throw new b("effect:unknown-effect",`Effect '${r.name}' is not supported`,{effect:r})}function br(r){let n=1;return Y(r.parameters,1),r.parameters.length===1&&(n=E(r.parameters[0])),new et(r.name,n)}function vr(r){let n=1;return Y(r.parameters,1),r.parameters.length===1&&(n=E(r.parameters[0])),new zt(n)}function $r(r){let n=0;return Y(r.parameters,1),r.parameters.length===1&&(n=Sr(r.parameters[0])),new It(n)}function Mr(r){let n=0;return Y(r.parameters,1),r.parameters.length===1&&(n=st(r.parameters[0]),U(n,r.parameters[0])),new Nt(n)}function Ar(r){const n=[];let t=null;for(const u of r.parameters)if(u.type==="color"){if(n.length&&Object.freeze(n),t)throw new b("effect:type-error","Accepts only one color",{});t=Nr(u)}else{const f=st(u);if(Object.isFrozen(n))throw new b("effect:type-error","<length> parameters not consecutive",{lengths:n});n.push(f),n.length===3&&U(f,u)}if(n.length<2||n.length>3)throw new b("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${n.length}}`,{lengths:n});return new jt(n[0],n[1],n[2]||0,t||Yt("black"))}function Cr(r){let n=1,t=0,u=0;return Y(r.parameters,3),r.parameters[0]&&(n=E(r.parameters[0])),r.parameters[1]&&(t=st(r.parameters[1]),U(t,r.parameters[1])),r.parameters[2]&&(u=E(r.parameters[2])),new Rt(n,t,u)}function Y(r,n){if(r.length>n)throw new b("effect:type-error",`Function supports up to ${n} parameters, Actual: ${r.length}`,{parameters:r})}function K(r){if(r.type==="color")return"<color>";if(r.unit){if(r.unit in nt)return"<length>";if(r.unit in rt)return"<angle>";if(r.unit==="%")return"<percentage>"}return"<double>"}function U(r,n){if(r<0)throw new b("effect:type-error",`Negative values are not allowed, Actual: ${r}`,{term:n})}function Fr(r){if(r.type!=="quantity"||r.unit!==null)throw new b("effect:type-error",`Expected <double>, Actual: ${K(r)}`,{term:r})}function Er(r){if(r.type!=="quantity"||r.unit!==null&&r.unit!=="%")throw new b("effect:type-error",`Expected <double> or <percentage>, Actual: ${K(r)}`,{term:r})}const rt={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _r(r){if(r.type!=="quantity"||!(r.value===0&&r.unit===null||r.unit&&rt[r.unit]!=null))throw new b("effect:type-error",`Expected <angle>, Actual: ${K(r)}`,{term:r})}const nt={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function kr(r){if(r.type!=="quantity"||!(r.value===0&&r.unit===null||r.unit&&nt[r.unit]!=null))throw new b("effect:type-error",`Expected <length>, Actual: ${K(r)}`,{term:r})}function E(r){Er(r);const n=r.value;return U(n,r),r.unit==="%"?.01*n:n}function Rr(r){return Fr(r),U(r.value,r),r.value}function Sr(r){return _r(r),r.value*rt[r.unit]||0}function st(r){return kr(r),r.value*nt[r.unit]||0}function Nr(r){switch(r.colorType){case"hex":return er(r.value);case"named":return Yt(r.value);case"function":return jr(r.value)}}function Yt(r){if(!rr(r))throw new b("effect:unknown-color",`color '${r}' isn't valid`,{namedColor:r});return nr(r)}const Or=/^rgba?/i,Pr=/^hsla?/i;function jr(r){if(Y(r.parameters,4),Or.test(r.name))return[E(r.parameters[0]),E(r.parameters[1]),E(r.parameters[2]),r.parameters[3]?E(r.parameters[3]):1];if(Pr.test(r.name))return sr(Rr(r.parameters[0]),E(r.parameters[1]),E(r.parameters[2]),r.parameters[3]?E(r.parameters[3]):1);throw new b("effect:syntax-error",`Invalid color function '${r.name}'`,{colorFunction:r})}function Jr(r,n,t){try{return zr(r)}catch(u){t?.messages?.push(u)}return null}function Ir(r,n,t,u){try{const f=qr(r);ar(t,f,n)}catch(f){u.messages&&u.messages.push(f)}}function qr(r){const n=Xt(r);return n?yr(n)?n.map(t=>t.toJSON()):n.map(({scale:t,effects:u})=>({scale:t,value:u.map(f=>f.toJSON())})):null}function zr(r){if(!r||r.length===0)return null;if(Tr(r)){const n=[];for(const t of r)n.push({scale:t.scale,value:Et(t.value)});return n}return Et(r)}function Tr(r){const n=r[0];return!!n&&"scale"in n}function Et(r){if(!r?.length)return"";const n=[];for(const t of r){let u=[];switch(t.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":u=[R(t,"amount")];break;case"blur":u=[R(t,"radius","pt")];break;case"hue-rotate":u=[R(t,"angle","deg")];break;case"drop-shadow":u=[R(t,"xoffset","pt"),R(t,"yoffset","pt"),R(t,"blurRadius","pt"),Xr(t,"color")];break;case"bloom":u=[R(t,"strength"),R(t,"radius","pt"),R(t,"threshold")]}const f=`${t.type}(${u.filter(Boolean).join(" ")})`;Xt(f),n.push(f)}return n.join(" ")}function R(r,n,t){if(r[n]==null)throw new b("effect:missing-parameter",`Missing parameter '${n}' in ${r.type} effect`,{effect:r});return t?r[n]+t:""+r[n]}function Xr(r,n){if(r[n]==null)throw new b("effect:missing-parameter",`Missing parameter '${n}' in ${r.type} effect`,{effect:r});const t=r[n];return`rgba(${t[0]||0}, ${t[1]||0}, ${t[2]||0}, ${t[3]/255||0})`}const Yr={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:tt}},"portal-item":{read:!0,write:{layerContainerTypes:tt}}}}},_t={read:{reader:Jr},write:{allowNull:!0,writer:Ir,layerContainerTypes:tt}},Lr={json:{read:!1,write:!1,origins:{"web-map":_t,"portal-item":_t}}},Kr=r=>{const n=r;let t=class extends n{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Z([At(Yr)],t.prototype,"blendMode",void 0),Z([At(Lr)],t.prototype,"effect",void 0),t=Z([or("esri.layers.mixins.BlendLayer")],t),t};export{Ir as a,Yr as b,Lr as l,Jr as n,Kr as p};
